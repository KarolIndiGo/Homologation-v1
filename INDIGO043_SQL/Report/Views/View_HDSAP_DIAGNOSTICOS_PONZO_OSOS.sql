-- Workspace: SQLServer
-- Item: INDIGO043 [SQL]
-- ItemId: SPN
-- Schema: Report
-- Object: View_HDSAP_DIAGNOSTICOS_PONZOÑOSOS
-- Extracted by Fabric SQL Extractor SPN v3.9.0




CREATE VIEW [Report].[View_HDSAP_DIAGNOSTICOS_PONZOÑOSOS]
AS

select distinct
       i.FECDIAGNO Fecha,
       id.CODICIE10 CodigoCIE10,
	   id.NOMDIAGNO Diagnostico,
	   i.IPCODPACI DocumentoPaciente,
	   p.IPNOMCOMP NombrePaciente,
	   p.IPTELMOVI TelefonoMovil,
	   p.IPFECNACI FechaNacimiento,
	   a.IFECHAING FechaIngreso,
	   case i.DIAINGEGR
	   when 'I'
	   then 'Ingreso'
	   when 'E'
	   then 'Egreso'
	   else 'Ambos'
	   end TipoDiagnostico,
   	    floor((((cast(datediff(day, p.IPFECNACI, 
		getdate()) as float)/365-(floor(cast(datediff(day, p.IPFECNACI, 
		getdate()) as float)/365)))*12)-floor((cast(datediff(day, p.IPFECNACI, 
		getdate()) as float)/365-(floor(cast(datediff(day, p.IPFECNACI, 
		getdate()) as float)/365)))*12))*(365/12)) AS "Dias", floor((cast(datediff(day, p.IPFECNACI, 
		getdate()) as float)/365-(floor(cast(datediff(day, p.IPFECNACI,
		getdate()) as float)/365)))*12) AS "Meses", 
		floor(cast(datediff(day, p.IPFECNACI, getdate()) as float)/365)  as Años,
	   case p.IPSEXOPAC
	   when 1
	   then 'Masculino'
	   when 2
	   then 'Femenino'
	   end SexoPaciente,
	   ad.DESACTIVI Ocupación,
	   ag.DESGRUPET GrupoEtnico,
	   m.MUNNOMBRE Municipio,
	   n.UBINOMBRE UbicacionResidencia,
	   p.IPDIRECCI DireccionResidencia,
	   f.UFUDESCRI UnidadFuncional,
	   d.NOMENTIDA EntidadAdmistradora,
	   concat (rtrim(pro.CODPROSAL),'--',pro.NOMMEDICO) ProfesionalSalud,
	   case a.TIPOINGRE
	   when 1
	   then 'Ambulatorio'
	   when 2
	   then 'Hospitalario'
	   End TipoIngreso,
	   case h.INDICAPAC
	   when 11
	   then 'Muerto'
	   else 'Vivo'
	   end EstadoFinalPaciente,
	   i.NUMINGRES Ingreso

from INDIAGNOH i
join INDIAGNOS id on id.CODDIAGNO = i.CODDIAGNO
join INPACIENT p on p.IPCODPACI = i.IPCODPACI
join ADINGRESO a on a.NUMINGRES = i.NUMINGRES
join INMUNICIP m on m.DEPMUNCOD = a.DEPMUNCOD
join ADACTIVID ad on ad.CODACTIVI = p.CODACTIVI
join ADGRUETNI ag on ag.CODGRUPOE = p.CODGRUPOE
join INUBICACI n on n.AUUBICACI = p.AUUBICACI
join INUNIFUNC f on f.UFUCODIGO = i.UFUCODIGO
join INENTIDAD d on d.CODENTIDA = p.CODENTIDA
join INPROFSAL pro on pro.CODPROSAL = i.CODPROSAL
join HCHISPACA h on h.NUMINGRES = a.NUMINGRES
WHERE ID.CODICIE10 IN ('X200 ',
'X201',
'X202',
'X203',
'X204',
'X205',
'X206',
'X207',
'X208',
'X209',
'X210',
'X211',
'X212',
'X213',
'X214',
'X215',
'X216',
'X217',
'X218',
'X219',
'X220',
'X221',
'X222',
'X223',
'X224',
'X225',
'X226',
'X227',
'X228',
'X229',
'X230',
'X231',
'X232',
'X233',
'X234',
'X235',
'X236',
'X237',
'X238',
'X239',
'X240',
'X241',
'X242',
'X243',
'X244',
'X245',
'X246',
'X247',
'X248',
'X249',
'X250',
'X251',
'X252',
'X253',
'X254',
'X255',
'X256',
'X257',
'X258',
'X259',
'X260',
'X261',
'X262',
'X263',
'X264',
'X265',
'X266',
'X267',
'X268',
'X269',
'X270',
'X271',
'X272',
'X273',
'X274',
'X275',
'X276',
'X277',
'X278',
'X279',
'X280',
'X281',
'X282',
'X283',
'X284',
'X285',
'X286',
'X287',
'X288',
'X289',
'X290',
'X291',
'X292',
'X293',
'X294',
'X295',
'X296',
'X297',
'X298',
'X299''X200 ',
'X201',
'X202',
'X203',
'X204',
'X205',
'X206',
'X207',
'X208',
'X209',
'X210',
'X211',
'X212',
'X213',
'X214',
'X215',
'X216',
'X217',
'X218',
'X219',
'X220',
'X221',
'X222',
'X223',
'X224',
'X225',
'X226',
'X227',
'X228',
'X229',
'X230',
'X231',
'X232',
'X233',
'X234',
'X235',
'X236',
'X237',
'X238',
'X239',
'X240',
'X241',
'X242',
'X243',
'X244',
'X245',
'X246',
'X247',
'X248',
'X249',
'X250',
'X251',
'X252',
'X253',
'X254',
'X255',
'X256',
'X257',
'X258',
'X259',
'X260',
'X261',
'X262',
'X263',
'X264',
'X265',
'X266',
'X267',
'X268',
'X269',
'X270',
'X271',
'X272',
'X273',
'X274',
'X275',
'X276',
'X277',
'X278',
'X279',
'X280',
'X281',
'X282',
'X283',
'X284',
'X285',
'X286',
'X287',
'X288',
'X289',
'X290',
'X291',
'X292',
'X293',
'X294',
'X295',
'X296',
'X297',
'X298',
'X299''T630',
'T631',
'T632',
'T633',
'T634',
'T635',
'T636',
'T637',
'T638',
'T639')

