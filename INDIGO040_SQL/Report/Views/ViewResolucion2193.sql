-- Workspace: SQLServer
-- Item: INDIGO040 [SQL]
-- ItemId: SPN
-- Schema: Report
-- Object: ViewResolucion2193
-- Extracted by Fabric SQL Extractor SPN v3.9.0



CREATE VIEW [Report].[ViewResolucion2193] as
/*
INDIGO006
INDIGO007
INDIGO008
INDIGO009
INDIGO010
INDIGO012
INDIGO013
INDIGO014
INDIGO015
INDIGO030
*/

WITH
CTE_VACUNAS
AS
(
 SELECT DISTINCT 
 F.PatientCode, 
 F.AdmissionNumber, 
 dos.ServiceDate,
 CUPS.Code,
 CUPS.Description, 
 COUNT (F.PatientCode) APLICADA, 
 CASE WHEN HA.EntityType =1 THEN 'Contributivo' WHEN HA.EntityType= 2 THEN 'Subsidiado' WHEN HA.EntityType= 3 THEN 'Vinculados Municipios'
	  WHEN HA.EntityType= 4 THEN 'Vinculados Departamentos' WHEN HA.EntityType= 5 THEN 'ARL Riesgos Laborales' 
	  WHEN HA.EntityType= 6 THEN 'Medicina Prepagada'WHEN HA.EntityType= 7 THEN 'IPS Privada' WHEN HA.EntityType= 8 THEN 'IPS Publica' 
	  WHEN HA.EntityType= 9 THEN 'Regimen Especial' WHEN HA.EntityType= 10 THEN 'Accidentes de transito' WHEN HA.EntityType= 11 THEN 'Fosyga' WHEN HA.EntityType= 12 THEN 'Otros' ELSE 'NO HAY DATO' END AS 'REGIMEN DE SALUD'  
	 , CAST(DOS.ServiceDate AS date) AS 'FECHA BUSQUEDA'
 FROM   BILLING.INVOICE AS F WITH (NOLOCK) 
		   INNER JOIN BILLING.INVOICEDETAIL AS DF WITH (NOLOCK) ON DF.INVOICEID = F.ID 
		   INNER JOIN BILLING.REVENUECONTROLDETAIL RCD WITH (NOLOCK) ON RCD.ID = F.REVENUECONTROLDETAILID 
		   INNER JOIN DBO.ADINGRESO AS ING WITH (NOLOCK) ON ING.NUMINGRES = F.ADMISSIONNUMBER 
		   INNER JOIN DBO.ADCENATEN AS CEN WITH (NOLOCK) ON CEN.CODCENATE = ING.CODCENATE 
		   INNER JOIN BILLING.SERVICEORDERDETAIL AS DOS WITH (NOLOCK) ON DOS.ID = DF.SERVICEORDERDETAILID
		   LEFT OUTER JOIN CONTRACT.CUPSENTITY AS CUPS WITH (NOLOCK) ON CUPS.ID = DOS.CUPSENTITYID
		   INNER JOIN .Contract.HealthAdministrator AS HA WITH(NOLOCK) ON HA.Id=ING.GENCONENTITY
	WHERE CUPS.CODE IN ('993102','993106','993120','993122','993130','993501','993502','993503','993504','993505','993509','993510',
	'993512','993513','993520','993522','995201','19937479-01','993101','993103','993104','993121','993123','993124','993125','993131',
	'993506','993507','993508','993521','995101','995202','903520')  AND F.Status=1 
GROUP BY  dos.ServiceDate,F.PatientCode, F.AdmissionNumber, CUPS.Code,CUPS.Description, CUPS.CODE, HA.EntityType
),

CTE_CONS_ENFERMERIA
AS
(
 
SELECT DISTINCT HIS.IPCODPACI,HIS.CODPROSAL, 1 NUMEROCONS, CASE WHEN HA.EntityType =1 THEN 'Contributivo' WHEN HA.EntityType= 2 THEN 'Subsidiado' WHEN HA.EntityType= 3 THEN 'Vinculados Municipios'
WHEN HA.EntityType= 4 THEN 'Vinculados Departamentos' WHEN HA.EntityType= 5 THEN 'ARL Riesgos Laborales' WHEN HA.EntityType= 6 THEN 'Medicina Prepagada'
WHEN HA.EntityType= 7 THEN 'IPS Privada' WHEN HA.EntityType= 8 THEN 'IPS Publica' WHEN HA.EntityType= 9 THEN 'Regimen Especial' 
WHEN HA.EntityType= 10 THEN 'Accidentes de transito' WHEN HA.EntityType= 11 THEN 'Fosyga' WHEN HA.EntityType= 12 THEN 'Otros' ELSE 'NO HAY DATO' END AS 'REGIMEN DE SALUD'
, CAST(HIS.FECHISPAC AS date) AS 'FECHA BUSQUEDA'
from HCHISPACA HIS
INNER JOIN ..ADINGRESO AS ING WITH(NOLOCK) ON ING.IPCODPACI=HIS.IPCODPACI
INNER JOIN .Contract.HealthAdministrator AS HA WITH(NOLOCK) ON HA.Id=ING.GENCONENTITY
WHERE HIS.IDMODELOHC IN('7','8','11') AND HIS.CODESPTRA='190' 
GROUP BY HIS.IPCODPACI,HIS.CODPROSAL, HA.EntityType, CAST(HIS.FECHISPAC AS date)
),

CTE_CONS_NOENFERMERIA
AS
(
SELECT DISTINCT HIS.IPCODPACI,HIS.CODPROSAL, 1 NUMEROCONS, ING.FECREGCRE,HIS.ID HISTORIA,MAX(HA.Id) ENTIDAD, HIS.NUMEFOLIO,ING.NUMINGRES,
CASE WHEN HA.EntityType =1 THEN 'Contributivo' WHEN HA.EntityType= 2 THEN 'Subsidiado' WHEN HA.EntityType= 3 THEN 'Vinculados Municipios'
WHEN HA.EntityType= 4 THEN 'Vinculados Departamentos' WHEN HA.EntityType= 5 THEN 'ARL Riesgos Laborales' WHEN HA.EntityType= 6 THEN 'Medicina Prepagada'
WHEN HA.EntityType= 7 THEN 'IPS Privada' WHEN HA.EntityType= 8 THEN 'IPS Publica' WHEN HA.EntityType= 9 THEN 'Regimen Especial' 
WHEN HA.EntityType= 10 THEN 'Accidentes de transito' WHEN HA.EntityType= 11 THEN 'Fosyga' WHEN HA.EntityType= 12 THEN 'Otros' ELSE 'NO HAY DATO' END AS 'REGIMEN DE SALUD' 
, CAST(ING.FECREGCRE AS date) AS 'FECHA BUSQUEDA'
from HCHISPACA HIS
INNER JOIN ..ADINGRESO AS ING WITH(NOLOCK) ON ING.IPCODPACI=HIS.IPCODPACI AND HIS.NUMINGRES=ING.NUMINGRES
INNER JOIN .Contract.HealthAdministrator AS HA WITH(NOLOCK) ON HA.Id=ING.GENCONENTITY	
	WHERE HIS.IDMODELOHC NOT IN('7','8','11','35') AND HIS.CODESPTRA='190'
	GROUP BY HIS.IPCODPACI,HIS.CODPROSAL, HA.EntityType, ING.FECREGCRE, HIS.ID, HA.ID, HIS.NUMEFOLIO, ING.NUMINGRES
),

CTE_CONS_MEDELECTIVAS
AS
(
  SELECT DISTINCT F.PatientCode, F.AdmissionNumber, dos.ServiceDate,CUPS.Code,CUPS.Description, 1 NUMEROCONS, CASE WHEN HA.EntityType =1 THEN 'Contributivo' WHEN HA.EntityType= 2 THEN 'Subsidiado' WHEN HA.EntityType= 3 THEN 'Vinculados Municipios'
WHEN HA.EntityType= 4 THEN 'Vinculados Departamentos' WHEN HA.EntityType= 5 THEN 'ARL Riesgos Laborales' WHEN HA.EntityType= 6 THEN 'Medicina Prepagada'
WHEN HA.EntityType= 7 THEN 'IPS Privada' WHEN HA.EntityType= 8 THEN 'IPS Publica' WHEN HA.EntityType= 9 THEN 'Regimen Especial' 
WHEN HA.EntityType= 10 THEN 'Accidentes de transito' WHEN HA.EntityType= 11 THEN 'Fosyga' WHEN HA.EntityType= 12 THEN 'Otros' ELSE 'NO HAY DATO' END AS 'REGIMEN DE SALUD'  
, CAST(DOS.ServiceDate AS date) AS 'FECHA BUSQUEDA'
 FROM   BILLING.INVOICE AS F WITH (NOLOCK) 
		   INNER JOIN BILLING.INVOICEDETAIL AS DF WITH (NOLOCK) ON DF.INVOICEID = F.ID 
		   INNER JOIN BILLING.REVENUECONTROLDETAIL RCD WITH (NOLOCK) ON RCD.ID = F.REVENUECONTROLDETAILID 
		   INNER JOIN DBO.ADINGRESO AS ING WITH (NOLOCK) ON ING.NUMINGRES = F.ADMISSIONNUMBER 
		   INNER JOIN DBO.ADCENATEN AS CEN WITH (NOLOCK) ON CEN.CODCENATE = ING.CODCENATE 
		   INNER JOIN BILLING.SERVICEORDERDETAIL AS DOS WITH (NOLOCK) ON DOS.ID = DF.SERVICEORDERDETAILID
		   LEFT OUTER JOIN CONTRACT.CUPSENTITY AS CUPS WITH (NOLOCK) ON CUPS.ID = DOS.CUPSENTITYID
		   INNER JOIN .Contract.HealthAdministrator AS HA WITH(NOLOCK) ON HA.Id=ING.GENCONENTITY
	WHERE CUPS.CODE IN ('890201', '890301') 
		  /*AND CAST(DOS.ServiceDate AS DATE)  BETWEEN CAST(CONCAT(CASE WHEN  (MONTH(GETDATE()) - 7) <> 0  THEN  (MONTH(GETDATE()) - 7) ELSE  12 END,'/','01/', CASE WHEN  (MONTH(GETDATE()) - 7) <> 0  THEN  YEAR(GETDATE()) ELSE  (YEAR(GETDATE()) - 7) END) as date) AND GETDATE() */
GROUP BY  dos.ServiceDate,F.PatientCode, F.AdmissionNumber, CUPS.Code,CUPS.Description, CUPS.CODE, HA.EntityType

),



CTE_CONS_MEDURGENC
AS
(
SELECT HIS.IPCODPACI,HIS.CODPROSAL, 1 NUMEROCONS, CASE WHEN HA.EntityType =1 THEN 'Contributivo' WHEN HA.EntityType= 2 THEN 'Subsidiado' WHEN HA.EntityType= 3 THEN 'Vinculados Municipios'
WHEN HA.EntityType= 4 THEN 'Vinculados Departamentos' WHEN HA.EntityType= 5 THEN 'ARL Riesgos Laborales' WHEN HA.EntityType= 6 THEN 'Medicina Prepagada'
WHEN HA.EntityType= 7 THEN 'IPS Privada' WHEN HA.EntityType= 8 THEN 'IPS Publica' WHEN HA.EntityType= 9 THEN 'Regimen Especial' 
WHEN HA.EntityType= 10 THEN 'Accidentes de transito' WHEN HA.EntityType= 11 THEN 'Fosyga' WHEN HA.EntityType= 12 THEN 'Otros' ELSE 'NO HAY DATO' END AS 'REGIMEN DE SALUD'  
, CAST(HIS.FECHISPAC AS date) AS 'FECHA BUSQUEDA'
from HCHISPACA HIS
INNER JOIN ..ADINGRESO AS ING WITH(NOLOCK) ON ING.IPCODPACI=HIS.IPCODPACI
INNER JOIN .Contract.HealthAdministrator AS HA WITH(NOLOCK) ON HA.Id=ING.GENCONENTITY	
	
	WHERE HIS.CODESPTRA = '002' AND  HIS.GENCONEXT='0' AND HIS.IDMODELOHC IS NULL AND HIS.IDETIPHIS='HCURGING1' 
	/*AND  CAST(HIS.FECHISPAC AS DATE) BETWEEN '2021-11-01' AND '2021-11-30'*/ AND ING.IINGREPOR=1

	GROUP BY HIS.IPCODPACI,HIS.CODPROSAL, HA.EntityType ,CAST(HIS.FECHISPAC AS date)
),

CTE_CONS_ESPEC_ELECTIVAS
AS
(
SELECT  HIS.IPCODPACI, HIS.CODESPTRA, 1 CONSULTAS, CASE WHEN HA.EntityType =1 THEN 'Contributivo' WHEN HA.EntityType= 2 THEN 'Subsidiado' WHEN HA.EntityType= 3 THEN 'Vinculados Municipios'
WHEN HA.EntityType= 4 THEN 'Vinculados Departamentos' WHEN HA.EntityType= 5 THEN 'ARL Riesgos Laborales' WHEN HA.EntityType= 6 THEN 'Medicina Prepagada'
WHEN HA.EntityType= 7 THEN 'IPS Privada' WHEN HA.EntityType= 8 THEN 'IPS Publica' WHEN HA.EntityType= 9 THEN 'Regimen Especial' 
WHEN HA.EntityType= 10 THEN 'Accidentes de transito' WHEN HA.EntityType= 11 THEN 'Fosyga' WHEN HA.EntityType= 12 THEN 'Otros' ELSE 'NO HAY DATO' END AS 'REGIMEN DE SALUD'
, CAST(HIS.FECHISPAC AS date) AS 'FECHA BUSQUEDA'

FROM HCHISPACA HIS
INNER JOIN ..ADINGRESO AS ING WITH(NOLOCK) ON ING.IPCODPACI=HIS.IPCODPACI
INNER JOIN .Contract.HealthAdministrator AS HA WITH(NOLOCK) ON HA.Id=ING.GENCONENTITY

WHERE HIS.CODESPTRA IN ('004','005','009','018','034','035','036','037','038','039','040','041','042','043','044','045','046','047','048','049','050','051','052','053','054','055','056'
,'058','061','062','063','064','066','067','068','069','071','077','079','080','081','082','083','084','085','086','087','088','090','091','092','093','094','095'
,'096','097','098','099','100','101','102','103','104','105','106','107','108','109','110','111','112','115','123','124','125','128','129','130','131','133'
,'134','135','136','137','138','139','140','141','142','143','152','153','154','155','156','157','158','159','160','162','163','164','165','166','167','168','169'
,'170','171','172','173','175','176','177','178','179','180','181','182','183','189','194','197','218','219','220','221','222','224','229','240','242','243','244'
,'246','247','326','327','328','329','330','331','332','333','335','337','339','342','345','346','348','354','355','356','357','364','366') AND HIS.GENCONEXT='1' 
/*AND  CAST(HIS.FECHISPAC AS DATE) BETWEEN CAST(CONCAT(CASE WHEN  (MONTH(GETDATE()) - 7) <> 0  THEN  (MONTH(GETDATE()) - 7) ELSE  12 END,'/','01/', CASE WHEN  (MONTH(GETDATE()) - 7) <> 0  THEN  YEAR(GETDATE()) ELSE  (YEAR(GETDATE()) - 7) END) as date) AND GETDATE()*/
GROUP BY HIS.IPCODPACI, HIS.CODESPTRA, HA.EntityType,CAST(HIS.FECHISPAC AS date)
),

CTE_CONS_ESPEC_URGENTES
AS
(
SELECT  HIS.IPCODPACI, HIS.CODESPTRA, COUNT(HIS.IPCODPACI) CONSULTAS, CASE WHEN HA.EntityType =1 THEN 'Contributivo' WHEN HA.EntityType= 2 THEN 'Subsidiado' WHEN HA.EntityType= 3 THEN 'Vinculados Municipios'
WHEN HA.EntityType= 4 THEN 'Vinculados Departamentos' WHEN HA.EntityType= 5 THEN 'ARL Riesgos Laborales' WHEN HA.EntityType= 6 THEN 'Medicina Prepagada'
WHEN HA.EntityType= 7 THEN 'IPS Privada' WHEN HA.EntityType= 8 THEN 'IPS Publica' WHEN HA.EntityType= 9 THEN 'Regimen Especial' 
WHEN HA.EntityType= 10 THEN 'Accidentes de transito' WHEN HA.EntityType= 11 THEN 'Fosyga' WHEN HA.EntityType= 12 THEN 'Otros' ELSE 'NO HAY DATO' END AS 'REGIMEN DE SALUD'
, CAST(HIS.FECHISPAC AS date) AS 'FECHA BUSQUEDA'
FROM HCHISPACA HIS
INNER JOIN ..ADINGRESO AS ING WITH(NOLOCK) ON ING.IPCODPACI=HIS.IPCODPACI
INNER JOIN .Contract.HealthAdministrator AS HA WITH(NOLOCK) ON HA.Id=ING.GENCONENTITY
WHERE HIS.CODESPTRA IN ('004','005','009','018','034','035','036','037','038','039','040','041','042','043','044','045','046','047','048','049','050','051','052','053','054','055','056'
,'058','061','062','063','064','066','067','068','069','071','077','079','080','081','082','083','084','085','086','087','088','090','091','092','093','094','095'
,'096','097','098','099','100','101','102','103','104','105','106','107','108','109','110','111','112','115','123','124','125','128','129','130','131','133'
,'134','135','136','137','138','139','140','141','142','143','152','153','154','155','156','157','158','159','160','162','163','164','165','166','167','168','169'
,'170','171','172','173','175','176','177','178','179','180','181','182','183','189','194','197','218','219','220','221','222','224','229','240','242','243','244'
,'246','247','326','327','328','329','330','331','332','333','335','337','339','342','345','346','348','354','355','356','357','364','366') AND HIS.GENCONEXT='0' 
/*AND  CAST(HIS.FECHISPAC AS DATE) BETWEEN CAST(CONCAT(CASE WHEN  (MONTH(GETDATE()) - 7) <> 0  THEN  (MONTH(GETDATE()) - 7) ELSE  12 END,'/','01/', CASE WHEN  (MONTH(GETDATE()) - 7) <> 0  THEN  YEAR(GETDATE()) ELSE  (YEAR(GETDATE()) - 7) END) as date) AND GETDATE()*/
GROUP BY HIS.IPCODPACI, HIS.CODESPTRA, HA.EntityType,CAST(HIS.FECHISPAC AS date)
),

CTE_OTRAS_CONSULTAS_ELECTIVAS
AS
(
SELECT  HIS.IPCODPACI, HIS.CODESPTRA, 1 CONSULTAS, CASE WHEN HA.EntityType =1 THEN 'Contributivo' WHEN HA.EntityType= 2 THEN 'Subsidiado' WHEN HA.EntityType= 3 THEN 'Vinculados Municipios'
WHEN HA.EntityType= 4 THEN 'Vinculados Departamentos' WHEN HA.EntityType= 5 THEN 'ARL Riesgos Laborales' WHEN HA.EntityType= 6 THEN 'Medicina Prepagada'
WHEN HA.EntityType= 7 THEN 'IPS Privada' WHEN HA.EntityType= 8 THEN 'IPS Publica' WHEN HA.EntityType= 9 THEN 'Regimen Especial' 
WHEN HA.EntityType= 10 THEN 'Accidentes de transito' WHEN HA.EntityType= 11 THEN 'Fosyga' WHEN HA.EntityType= 12 THEN 'Otros' ELSE 'NO HAY DATO' END AS 'REGIMEN DE SALUD'
, CAST(HIS.FECHISPAC AS date) AS 'FECHA BUSQUEDA'
FROM HCHISPACA HIS
INNER JOIN ..ADINGRESO AS ING WITH(NOLOCK) ON ING.IPCODPACI=HIS.IPCODPACI
INNER JOIN .Contract.HealthAdministrator AS HA WITH(NOLOCK) ON HA.Id=ING.GENCONENTITY
WHERE HIS.CODESPTRA IN ('031','032','033','076','078','090','091','103','104','126','164','165','166','167','168','169','170','171','172','173','175','176','177','184','185','192','193'
,'196','198','200','201','202','203','207','221','365') AND HIS.GENCONEXT='1' 
/*AND  CAST(HIS.FECHISPAC AS DATE) BETWEEN CAST(CONCAT(CASE WHEN  (MONTH(GETDATE()) - 7) <> 0  THEN  (MONTH(GETDATE()) - 7) ELSE  12 END,'/','01/', CASE WHEN  (MONTH(GETDATE()) - 7) <> 0  THEN  YEAR(GETDATE()) ELSE  (YEAR(GETDATE()) - 7) END) as date) AND GETDATE()*/
GROUP BY HIS.IPCODPACI, HIS.CODESPTRA, HA.EntityType,CAST(HIS.FECHISPAC AS date)
),

CTE_OTRAS_CONSULTAS_URGENTES
AS
(
SELECT  HIS.IPCODPACI, HIS.CODESPTRA, COUNT(HIS.IPCODPACI) CONSULTAS, CASE WHEN HA.EntityType =1 THEN 'Contributivo' WHEN HA.EntityType= 2 THEN 'Subsidiado' WHEN HA.EntityType= 3 THEN 'Vinculados Municipios'
WHEN HA.EntityType= 4 THEN 'Vinculados Departamentos' WHEN HA.EntityType= 5 THEN 'ARL Riesgos Laborales' WHEN HA.EntityType= 6 THEN 'Medicina Prepagada'
WHEN HA.EntityType= 7 THEN 'IPS Privada' WHEN HA.EntityType= 8 THEN 'IPS Publica' WHEN HA.EntityType= 9 THEN 'Regimen Especial' 
WHEN HA.EntityType= 10 THEN 'Accidentes de transito' WHEN HA.EntityType= 11 THEN 'Fosyga' WHEN HA.EntityType= 12 THEN 'Otros' ELSE 'NO HAY DATO' END AS 'REGIMEN DE SALUD'
, CAST(HIS.FECHISPAC AS date) AS 'FECHA BUSQUEDA'
FROM HCHISPACA HIS
INNER JOIN ..ADINGRESO AS ING WITH(NOLOCK) ON ING.IPCODPACI=HIS.IPCODPACI
INNER JOIN .Contract.HealthAdministrator AS HA WITH(NOLOCK) ON HA.Id=ING.GENCONENTITY
WHERE HIS.CODESPTRA IN ('031','032','033','076','078','090','091','103','104','126','164','165','166','167','168','169','170','171','172','173','175','176','177','184','185','192','193'
,'195','196','198','200','201','202','203','207','221','351','365') AND HIS.GENCONEXT='0' 
/*AND  CAST(HIS.FECHISPAC AS DATE) BETWEEN CAST(CONCAT(CASE WHEN  (MONTH(GETDATE()) - 7) <> 0  THEN  (MONTH(GETDATE()) - 7) ELSE  12 END,'/','01/', CASE WHEN  (MONTH(GETDATE()) - 7) <> 0  THEN  YEAR(GETDATE()) ELSE  (YEAR(GETDATE()) - 7) END) as date) AND GETDATE()*/
GROUP BY HIS.IPCODPACI, HIS.CODESPTRA, HA.EntityType,CAST(HIS.FECHISPAC AS date)
),

CTE_ODONTOLOGIA_VALORACION
AS
(
SELECT HIS.IPCODPACI, HIS.CODESPTRA, HIS.NUMINGRES, 1 CANTIDAD, CASE WHEN HA.EntityType =1 THEN 'Contributivo' WHEN HA.EntityType= 2 THEN 'Subsidiado' WHEN HA.EntityType= 3 THEN 'Vinculados Municipios'
WHEN HA.EntityType= 4 THEN 'Vinculados Departamentos' WHEN HA.EntityType= 5 THEN 'ARL Riesgos Laborales' WHEN HA.EntityType= 6 THEN 'Medicina Prepagada'
WHEN HA.EntityType= 7 THEN 'IPS Privada' WHEN HA.EntityType= 8 THEN 'IPS Publica' WHEN HA.EntityType= 9 THEN 'Regimen Especial' 
WHEN HA.EntityType= 10 THEN 'Accidentes de transito' WHEN HA.EntityType= 11 THEN 'Fosyga' WHEN HA.EntityType= 12 THEN 'Otros' ELSE 'NO HAY DATO' END AS 'REGIMEN DE SALUD'
, CAST(HIS.FECHISPAC AS date) AS 'FECHA BUSQUEDA'
FROM HCHISPACA HIS
INNER JOIN ..ADINGRESO AS ING WITH(NOLOCK) ON ING.IPCODPACI=HIS.IPCODPACI
INNER JOIN .Contract.HealthAdministrator AS HA WITH(NOLOCK) ON HA.Id=ING.GENCONENTITY
WHERE IDMODELOHC = '28' 
/*AND  CAST(HIS.FECHISPAC AS DATE) BETWEEN CAST(CONCAT(CASE WHEN  (MONTH(GETDATE()) - 7) <> 0  THEN  (MONTH(GETDATE()) - 7) ELSE  12 END,'/','01/', CASE WHEN  (MONTH(GETDATE()) - 7) <> 0  THEN  YEAR(GETDATE()) ELSE  (YEAR(GETDATE()) - 7) END) as date) AND GETDATE() */
GROUP BY HIS.IPCODPACI, HIS.CODESPTRA, HIS.NUMINGRES, HA.EntityType,CAST(HIS.FECHISPAC AS date)
),
CTE_ODONTOLOGIA_SESIONES
AS
( 
SELECT HIS.IPCODPACI, HIS.CODESPTRA, HIS.NUMINGRES, 1 CANTIDAD, CASE WHEN HA.EntityType =1 THEN 'Contributivo' WHEN HA.EntityType= 2 THEN 'Subsidiado' WHEN HA.EntityType= 3 THEN 'Vinculados Municipios'
WHEN HA.EntityType= 4 THEN 'Vinculados Departamentos' WHEN HA.EntityType= 5 THEN 'ARL Riesgos Laborales' WHEN HA.EntityType= 6 THEN 'Medicina Prepagada'
WHEN HA.EntityType= 7 THEN 'IPS Privada' WHEN HA.EntityType= 8 THEN 'IPS Publica' WHEN HA.EntityType= 9 THEN 'Regimen Especial' 
WHEN HA.EntityType= 10 THEN 'Accidentes de transito' WHEN HA.EntityType= 11 THEN 'Fosyga' WHEN HA.EntityType= 12 THEN 'Otros' ELSE 'NO HAY DATO' END AS 'REGIMEN DE SALUD'
, CAST(HIS.FECHISPAC AS date) AS 'FECHA BUSQUEDA'
FROM HCHISPACA HIS
INNER JOIN ..ADINGRESO AS ING WITH(NOLOCK) ON ING.IPCODPACI=HIS.IPCODPACI
INNER JOIN .Contract.HealthAdministrator AS HA WITH(NOLOCK) ON HA.Id=ING.GENCONENTITY
INNER JOIN ..PRMODELOHC AS MODE WITH(NOLOCK) ON MODE.ID = HIS.IDMODELOHC
WHERE MODE.DESCRIPCION LIKE '%control%' and MODE.DESCRIPCION LIKE '%odont%' 
/*AND  CAST(HIS.FECHISPAC AS DATE) BETWEEN CAST(CONCAT(CASE WHEN  (MONTH(GETDATE()) - 7) <> 0  THEN  (MONTH(GETDATE()) - 7) ELSE  12 END,'/','01/', CASE WHEN  (MONTH(GETDATE()) - 7) <> 0  THEN  YEAR(GETDATE()) ELSE  (YEAR(GETDATE()) - 7) END) as date) AND GETDATE()*/
GROUP BY HIS.IPCODPACI, HIS.CODESPTRA, HIS.NUMINGRES, HA.EntityType,CAST(HIS.FECHISPAC AS date)
),

CTE_TRATAMIENTOS_TERMINADOS
AS
(
SELECT RS.VALOR, COUNT(RS.VALOR) CANTIDAD, CASE WHEN HA.EntityType =1 THEN 'Contributivo' WHEN HA.EntityType= 2 THEN 'Subsidiado' WHEN HA.EntityType= 3 THEN 'Vinculados Municipios'
WHEN HA.EntityType= 4 THEN 'Vinculados Departamentos' WHEN HA.EntityType= 5 THEN 'ARL Riesgos Laborales' WHEN HA.EntityType= 6 THEN 'Medicina Prepagada'
WHEN HA.EntityType= 7 THEN 'IPS Privada' WHEN HA.EntityType= 8 THEN 'IPS Publica' WHEN HA.EntityType= 9 THEN 'Regimen Especial' 
WHEN HA.EntityType= 10 THEN 'Accidentes de transito' WHEN HA.EntityType= 11 THEN 'Fosyga' WHEN HA.EntityType= 12 THEN 'Otros' ELSE 'NO HAY DATO' END AS 'REGIMEN DE SALUD' 
, CAST(HC.FECHISPAC AS date) AS 'FECHA BUSQUEDA'
FROM report.[TablaRevisionXSistema] as RS
INNER JOIN ..HCHISPACA AS HC WITH(NOLOCK) ON HC.ID=RS.IDHCHISPACA AND rs.IDRSVARIABLE = 218 AND rs.VALOR = 1
INNER JOIN ..ADINGRESO AS ING WITH(NOLOCK) ON ING.IPCODPACI=HC.IPCODPACI
INNER JOIN .Contract.HealthAdministrator AS HA WITH(NOLOCK) ON HA.Id=ING.GENCONENTITY
GROUP BY RS.VALOR, HA.EntityType, CAST(HC.FECHISPAC AS date)
) ,

CTE_FACTURACION_SELLANTES
    AS
	(
	SELECT DISTINCT F.PatientCode, F.AdmissionNumber, dos.ServiceDate,CUPS.Code,CUPS.Description,  DF.InvoicedQuantity CANTIDAD,CASE WHEN HA.EntityType =1 THEN 'Contributivo' WHEN HA.EntityType= 2 THEN 'Subsidiado' WHEN HA.EntityType= 3 THEN 'Vinculados Municipios'
WHEN HA.EntityType= 4 THEN 'Vinculados Departamentos' WHEN HA.EntityType= 5 THEN 'ARL Riesgos Laborales' WHEN HA.EntityType= 6 THEN 'Medicina Prepagada'
WHEN HA.EntityType= 7 THEN 'IPS Privada' WHEN HA.EntityType= 8 THEN 'IPS Publica' WHEN HA.EntityType= 9 THEN 'Regimen Especial' 
WHEN HA.EntityType= 10 THEN 'Accidentes de transito' WHEN HA.EntityType= 11 THEN 'Fosyga' WHEN HA.EntityType= 12 THEN 'Otros' ELSE 'NO HAY DATO' END AS 'REGIMEN DE SALUD'  
, CAST(DOS.ServiceDate AS date) AS 'FECHA BUSQUEDA'
 FROM   BILLING.INVOICE AS F WITH (NOLOCK) 
		   INNER JOIN BILLING.INVOICEDETAIL AS DF WITH (NOLOCK) ON DF.INVOICEID = F.ID 
		   INNER JOIN BILLING.REVENUECONTROLDETAIL RCD WITH (NOLOCK) ON RCD.ID = F.REVENUECONTROLDETAILID 
		   INNER JOIN DBO.ADINGRESO AS ING WITH (NOLOCK) ON ING.NUMINGRES = F.ADMISSIONNUMBER 
		   INNER JOIN DBO.ADCENATEN AS CEN WITH (NOLOCK) ON CEN.CODCENATE = ING.CODCENATE 
		   INNER JOIN BILLING.SERVICEORDERDETAIL AS DOS WITH (NOLOCK) ON DOS.ID = DF.SERVICEORDERDETAILID
		   LEFT OUTER JOIN CONTRACT.CUPSENTITY AS CUPS WITH (NOLOCK) ON CUPS.ID = DOS.CUPSENTITYID
		   INNER JOIN .Contract.HealthAdministrator AS HA WITH(NOLOCK) ON HA.Id=ING.GENCONENTITY
	WHERE CUPS.CODE IN ('997101','997102') AND F.Status =1
		     /*AND CAST(DOS.ServiceDate AS DATE) BETWEEN CAST(CONCAT(CASE WHEN  (MONTH(GETDATE()) - 7) <> 0  THEN  (MONTH(GETDATE()) - 7) ELSE  12 END,'/','01/',                                                 
                                                                                             CASE WHEN  (MONTH(GETDATE()) - 7) <> 0  THEN  YEAR(GETDATE()) ELSE  (YEAR(GETDATE()) - 7) END) as date) AND GETDATE()*/
GROUP BY  dos.ServiceDate,F.PatientCode, F.AdmissionNumber, CUPS.Code,CUPS.Description, CUPS.CODE, HA.EntityType, DF.InvoicedQuantity
	),

	CTE_FACTURACION_CITOLOGIAS
    AS
	(
	  SELECT DISTINCT F.PatientCode, DF.InvoicedQuantity CANTIDAD, CASE WHEN HA.EntityType =1 THEN 'Contributivo' WHEN HA.EntityType= 2 THEN 'Subsidiado' WHEN HA.EntityType= 3 THEN 'Vinculados Municipios'
WHEN HA.EntityType= 4 THEN 'Vinculados Departamentos' WHEN HA.EntityType= 5 THEN 'ARL Riesgos Laborales' WHEN HA.EntityType= 6 THEN 'Medicina Prepagada'
WHEN HA.EntityType= 7 THEN 'IPS Privada' WHEN HA.EntityType= 8 THEN 'IPS Publica' WHEN HA.EntityType= 9 THEN 'Regimen Especial' 
WHEN HA.EntityType= 10 THEN 'Accidentes de transito' WHEN HA.EntityType= 11 THEN 'Fosyga' WHEN HA.EntityType= 12 THEN 'Otros' ELSE 'NO HAY DATO' END AS 'REGIMEN DE SALUD' 
, CAST(F.InvoiceDate AS date) AS 'FECHA BUSQUEDA'
	  FROM   BILLING.INVOICE AS F WITH (NOLOCK) 
		   INNER JOIN BILLING.INVOICEDETAIL AS DF WITH (NOLOCK) ON DF.INVOICEID = F.ID 
		   INNER JOIN BILLING.REVENUECONTROLDETAIL RCD WITH (NOLOCK) ON RCD.ID = F.REVENUECONTROLDETAILID 
		   INNER JOIN DBO.ADINGRESO AS ING WITH (NOLOCK) ON ING.NUMINGRES = F.ADMISSIONNUMBER 
		   INNER JOIN DBO.ADCENATEN AS CEN WITH (NOLOCK) ON CEN.CODCENATE = ING.CODCENATE 
		   INNER JOIN BILLING.SERVICEORDERDETAIL AS DOS WITH (NOLOCK) ON DOS.ID = DF.SERVICEORDERDETAILID
		   LEFT OUTER JOIN CONTRACT.CUPSENTITY AS CUPS WITH (NOLOCK) ON CUPS.ID = DOS.CUPSENTITYID
		   INNER JOIN ..ADINGRESO AS ING1 WITH(NOLOCK) ON ING1.IPCODPACI=F.PatientCode
		   INNER JOIN .Contract.HealthAdministrator AS HA WITH(NOLOCK) ON HA.Id=ING.GENCONENTITY
		   WHERE CUPS.Code IN ('892901','898001') AND F.Status =1 
		   /*AND CAST(F.InvoiceDate AS DATE )  BETWEEN CAST(CONCAT(CASE WHEN  (MONTH(GETDATE()) - 7) <> 0  THEN  (MONTH(GETDATE()) - 7) ELSE  12 END,'/','01/', CASE WHEN  (MONTH(GETDATE()) - 7) <> 0  THEN  YEAR(GETDATE()) ELSE  (YEAR(GETDATE()) - 7) END) as date) AND GETDATE()*/
		   group by F.PatientCode, DF.InvoicedQuantity, HA.EntityType, CAST(F.InvoiceDate AS date)
	),

	CTE_SUPERFICIES
	AS
	(
SELECT DISTINCT F.PatientCode, DF.InvoicedQuantity APLICADOS, F.InvoiceDate,CASE WHEN HA.EntityType =1 THEN 'Contributivo' WHEN HA.EntityType= 2 THEN 'Subsidiado' WHEN HA.EntityType= 3 THEN 'Vinculados Municipios'
WHEN HA.EntityType= 4 THEN 'Vinculados Departamentos' WHEN HA.EntityType= 5 THEN 'ARL Riesgos Laborales' WHEN HA.EntityType= 6 THEN 'Medicina Prepagada'
WHEN HA.EntityType= 7 THEN 'IPS Privada' WHEN HA.EntityType= 8 THEN 'IPS Publica' WHEN HA.EntityType= 9 THEN 'Regimen Especial' 
WHEN HA.EntityType= 10 THEN 'Accidentes de transito' WHEN HA.EntityType= 11 THEN 'Fosyga' WHEN HA.EntityType= 12 THEN 'Otros' ELSE 'NO HAY DATO' END AS 'REGIMEN DE SALUD' 
, CAST(F.InvoiceDate AS date) AS 'FECHA BUSQUEDA'
	  FROM   BILLING.INVOICE AS F WITH (NOLOCK) 
		   INNER JOIN BILLING.INVOICEDETAIL AS DF WITH (NOLOCK) ON DF.INVOICEID = F.ID 
		   INNER JOIN BILLING.REVENUECONTROLDETAIL RCD WITH (NOLOCK) ON RCD.ID = F.REVENUECONTROLDETAILID 
		   INNER JOIN DBO.ADINGRESO AS ING WITH (NOLOCK) ON ING.NUMINGRES = F.ADMISSIONNUMBER 
		   INNER JOIN DBO.ADCENATEN AS CEN WITH (NOLOCK) ON CEN.CODCENATE = ING.CODCENATE 
		   INNER JOIN BILLING.SERVICEORDERDETAIL AS DOS WITH (NOLOCK) ON DOS.ID = DF.SERVICEORDERDETAILID
		   LEFT OUTER JOIN CONTRACT.CUPSENTITY AS CUPS WITH (NOLOCK) ON CUPS.ID = DOS.CUPSENTITYID
		   INNER JOIN ..ADINGRESO AS ING1 WITH(NOLOCK) ON ING1.IPCODPACI=F.PatientCode
		   INNER JOIN .Contract.HealthAdministrator AS HA WITH(NOLOCK) ON HA.Id=ING.GENCONENTITY
		   WHERE CUPS.Code IN ('232101','232102','232103','232104','232200','232105') AND F.Status =1 
		   /*AND CAST(F.InvoiceDate AS DATE )  BETWEEN CAST(CONCAT(CASE WHEN  (MONTH(GETDATE()) - 7) <> 0  THEN  (MONTH(GETDATE()) - 7) ELSE  12 END,'/','01/', CASE WHEN  (MONTH(GETDATE()) - 7) <> 0  THEN  YEAR(GETDATE()) ELSE  (YEAR(GETDATE()) - 7) END) as date) AND GETDATE()*/
		   group by F.PatientCode, DF.InvoicedQuantity, HA.EntityType, F.InvoiceDate
	),

CTE_EXODONCIAS
AS
(
	
SELECT DISTINCT F.PatientCode, DF.InvoicedQuantity REALIZADAS, F.InvoiceDate,CASE WHEN HA.EntityType =1 THEN 'Contributivo' WHEN HA.EntityType= 2 THEN 'Subsidiado' WHEN HA.EntityType= 3 THEN 'Vinculados Municipios'
WHEN HA.EntityType= 4 THEN 'Vinculados Departamentos' WHEN HA.EntityType= 5 THEN 'ARL Riesgos Laborales' WHEN HA.EntityType= 6 THEN 'Medicina Prepagada'
WHEN HA.EntityType= 7 THEN 'IPS Privada' WHEN HA.EntityType= 8 THEN 'IPS Publica' WHEN HA.EntityType= 9 THEN 'Regimen Especial' 
WHEN HA.EntityType= 10 THEN 'Accidentes de transito' WHEN HA.EntityType= 11 THEN 'Fosyga' WHEN HA.EntityType= 12 THEN 'Otros' ELSE 'NO HAY DATO' END AS 'REGIMEN DE SALUD' 
, CAST(F.InvoiceDate AS date) AS 'FECHA BUSQUEDA'
	  FROM   BILLING.INVOICE AS F WITH (NOLOCK) 
		   INNER JOIN BILLING.INVOICEDETAIL AS DF WITH (NOLOCK) ON DF.INVOICEID = F.ID 
		   INNER JOIN BILLING.REVENUECONTROLDETAIL RCD WITH (NOLOCK) ON RCD.ID = F.REVENUECONTROLDETAILID 
		   INNER JOIN DBO.ADINGRESO AS ING WITH (NOLOCK) ON ING.NUMINGRES = F.ADMISSIONNUMBER 
		   INNER JOIN DBO.ADCENATEN AS CEN WITH (NOLOCK) ON CEN.CODCENATE = ING.CODCENATE 
		   INNER JOIN BILLING.SERVICEORDERDETAIL AS DOS WITH (NOLOCK) ON DOS.ID = DF.SERVICEORDERDETAILID
		   LEFT OUTER JOIN CONTRACT.CUPSENTITY AS CUPS WITH (NOLOCK) ON CUPS.ID = DOS.CUPSENTITYID
		   INNER JOIN ..ADINGRESO AS ING1 WITH(NOLOCK) ON ING1.IPCODPACI=F.PatientCode
		   INNER JOIN .Contract.HealthAdministrator AS HA WITH(NOLOCK) ON HA.Id=ING.GENCONENTITY
		   WHERE CUPS.Code IN ('230101','230102','230201','230202','231100','231200','231400','230103','230203','231301','231302','231303') AND F.Status =1 
		   /*AND CAST(F.InvoiceDate AS DATE )  BETWEEN CAST(CONCAT(CASE WHEN  (MONTH(GETDATE()) - 7) <> 0  THEN  (MONTH(GETDATE()) - 7) ELSE  12 END,'/','01/', CASE WHEN  (MONTH(GETDATE()) - 7) <> 0  THEN  YEAR(GETDATE()) ELSE  (YEAR(GETDATE()) - 7) END) as date) AND GETDATE()*/
		   group by F.PatientCode, DF.InvoicedQuantity, HA.EntityType, F.InvoiceDate

),
CTE_PARTOS_VAGINAL
AS
  (
    SELECT DISTINCT F.PatientCode, F.AdmissionNumber, dos.ServiceDate,CUPS.Code,CUPS.Description, COUNT (F.PatientCode) PARTOS, CASE WHEN HA.EntityType =1 THEN 'Contributivo' WHEN HA.EntityType= 2 THEN 'Subsidiado' WHEN HA.EntityType= 3 THEN 'Vinculados Municipios'
WHEN HA.EntityType= 4 THEN 'Vinculados Departamentos' WHEN HA.EntityType= 5 THEN 'ARL Riesgos Laborales' WHEN HA.EntityType= 6 THEN 'Medicina Prepagada'
WHEN HA.EntityType= 7 THEN 'IPS Privada' WHEN HA.EntityType= 8 THEN 'IPS Publica' WHEN HA.EntityType= 9 THEN 'Regimen Especial' 
WHEN HA.EntityType= 10 THEN 'Accidentes de transito' WHEN HA.EntityType= 11 THEN 'Fosyga' WHEN HA.EntityType= 12 THEN 'Otros' ELSE 'NO HAY DATO' END AS 'REGIMEN DE SALUD'  
, CAST(DOS.ServiceDate AS date) AS 'FECHA BUSQUEDA'
 FROM   BILLING.INVOICE AS F WITH (NOLOCK) 
		   INNER JOIN BILLING.INVOICEDETAIL AS DF WITH (NOLOCK) ON DF.INVOICEID = F.ID 
		   INNER JOIN BILLING.REVENUECONTROLDETAIL RCD WITH (NOLOCK) ON RCD.ID = F.REVENUECONTROLDETAILID 
		   INNER JOIN DBO.ADINGRESO AS ING WITH (NOLOCK) ON ING.NUMINGRES = F.ADMISSIONNUMBER 
		   INNER JOIN DBO.ADCENATEN AS CEN WITH (NOLOCK) ON CEN.CODCENATE = ING.CODCENATE 
		   INNER JOIN BILLING.SERVICEORDERDETAIL AS DOS WITH (NOLOCK) ON DOS.ID = DF.SERVICEORDERDETAILID
		   LEFT OUTER JOIN CONTRACT.CUPSENTITY AS CUPS WITH (NOLOCK) ON CUPS.ID = DOS.CUPSENTITYID
		   INNER JOIN .Contract.HealthAdministrator AS HA WITH(NOLOCK) ON HA.Id=ING.GENCONENTITY
	WHERE CUPS.CODE IN ('721003','732201','735301','735930','735931','735980')
		    /* AND CAST(DOS.ServiceDate AS DATE)  BETWEEN CAST(CONCAT(CASE WHEN  (MONTH(GETDATE()) - 7) <> 0  THEN  (MONTH(GETDATE()) - 7) ELSE  12 END,'/','01/', CASE WHEN  (MONTH(GETDATE()) - 7) <> 0  THEN  YEAR(GETDATE()) ELSE  (YEAR(GETDATE()) - 7) END) as date) AND GETDATE() */
			AND F.Status=1
GROUP BY  dos.ServiceDate,F.PatientCode, F.AdmissionNumber, CUPS.Code,CUPS.Description, CUPS.CODE, HA.EntityType
  ),

  CTE_PARTOS_CESAREA
AS
  (
   SELECT DISTINCT F.PatientCode, F.AdmissionNumber, dos.ServiceDate,CUPS.Code,CUPS.Description,  COUNT(1) CESAREAS, CASE WHEN HA.EntityType =1 THEN 'Contributivo' WHEN HA.EntityType= 2 THEN 'Subsidiado' WHEN HA.EntityType= 3 THEN 'Vinculados Municipios'
WHEN HA.EntityType= 4 THEN 'Vinculados Departamentos' WHEN HA.EntityType= 5 THEN 'ARL Riesgos Laborales' WHEN HA.EntityType= 6 THEN 'Medicina Prepagada'
WHEN HA.EntityType= 7 THEN 'IPS Privada' WHEN HA.EntityType= 8 THEN 'IPS Publica' WHEN HA.EntityType= 9 THEN 'Regimen Especial' 
WHEN HA.EntityType= 10 THEN 'Accidentes de transito' WHEN HA.EntityType= 11 THEN 'Fosyga' WHEN HA.EntityType= 12 THEN 'Otros' ELSE 'NO HAY DATO' END AS 'REGIMEN DE SALUD'  
, CAST(DOS.ServiceDate AS date) AS 'FECHA BUSQUEDA'
 FROM   BILLING.INVOICE AS F WITH (NOLOCK) 
		   INNER JOIN BILLING.INVOICEDETAIL AS DF WITH (NOLOCK) ON DF.INVOICEID = F.ID 
		   INNER JOIN BILLING.REVENUECONTROLDETAIL RCD WITH (NOLOCK) ON RCD.ID = F.REVENUECONTROLDETAILID 
		   INNER JOIN DBO.ADINGRESO AS ING WITH (NOLOCK) ON ING.NUMINGRES = F.ADMISSIONNUMBER 
		   INNER JOIN DBO.ADCENATEN AS CEN WITH (NOLOCK) ON CEN.CODCENATE = ING.CODCENATE 
		   INNER JOIN BILLING.SERVICEORDERDETAIL AS DOS WITH (NOLOCK) ON DOS.ID = DF.SERVICEORDERDETAILID
		   LEFT OUTER JOIN CONTRACT.CUPSENTITY AS CUPS WITH (NOLOCK) ON CUPS.ID = DOS.CUPSENTITYID
		   INNER JOIN .Contract.HealthAdministrator AS HA WITH(NOLOCK) ON HA.Id=ING.GENCONENTITY
	WHERE CUPS.CODE IN ('740001','740002','740003')
		     /*AND CAST(DOS.ServiceDate AS DATE)  BETWEEN CAST(CONCAT(CASE WHEN  (MONTH(GETDATE()) - 7) <> 0  THEN  (MONTH(GETDATE()) - 7) ELSE  12 END,'/','01/', CASE WHEN  (MONTH(GETDATE()) - 7) <> 0  THEN  YEAR(GETDATE()) ELSE  (YEAR(GETDATE()) - 7) END) as date) AND GETDATE() */
			 AND F.Status=1
GROUP BY  F.PatientCode, F.AdmissionNumber, dos.ServiceDate,CUPS.Code,CUPS.Description, CUPS.CODE, HA.EntityType
	
  ),

  CTE_EGRESOS_OBSTETRICOS
  AS
  (
SELECT DISTINCT F.PatientCode, F.AdmissionNumber, dos.ServiceDate,CUPS.Code,CUPS.Description, ING.FECHEGRESO,COUNT (F.PatientCode) EGRESOS, CASE WHEN HA.EntityType =1 THEN 'Contributivo' WHEN HA.EntityType= 2 THEN 'Subsidiado' WHEN HA.EntityType= 3 THEN 'Vinculados Municipios'
WHEN HA.EntityType= 4 THEN 'Vinculados Departamentos' WHEN HA.EntityType= 5 THEN 'ARL Riesgos Laborales' WHEN HA.EntityType= 6 THEN 'Medicina Prepagada'
WHEN HA.EntityType= 7 THEN 'IPS Privada' WHEN HA.EntityType= 8 THEN 'IPS Publica' WHEN HA.EntityType= 9 THEN 'Regimen Especial' 
WHEN HA.EntityType= 10 THEN 'Accidentes de transito' WHEN HA.EntityType= 11 THEN 'Fosyga' WHEN HA.EntityType= 12 THEN 'Otros' ELSE 'NO HAY DATO' END AS 'REGIMEN DE SALUD'  
, CAST(DOS.ServiceDate AS date) AS 'FECHA BUSQUEDA'
 FROM   BILLING.INVOICE AS F WITH (NOLOCK) 
		   INNER JOIN BILLING.INVOICEDETAIL AS DF WITH (NOLOCK) ON DF.INVOICEID = F.ID 
		   INNER JOIN BILLING.REVENUECONTROLDETAIL RCD WITH (NOLOCK) ON RCD.ID = F.REVENUECONTROLDETAILID 
		   INNER JOIN DBO.ADINGRESO AS ING WITH (NOLOCK) ON ING.NUMINGRES = F.ADMISSIONNUMBER 
		   INNER JOIN DBO.ADCENATEN AS CEN WITH (NOLOCK) ON CEN.CODCENATE = ING.CODCENATE 
		   INNER JOIN BILLING.SERVICEORDERDETAIL AS DOS WITH (NOLOCK) ON DOS.ID = DF.SERVICEORDERDETAILID
		   LEFT OUTER JOIN CONTRACT.CUPSENTITY AS CUPS WITH (NOLOCK) ON CUPS.ID = DOS.CUPSENTITYID
		   INNER JOIN .Contract.HealthAdministrator AS HA WITH(NOLOCK) ON HA.Id=ING.GENCONENTITY
	WHERE CUPS.CODE IN ('721003','732201','735301','735930','735931','735980','740001','740002','740003')
		     /*AND CAST(DOS.ServiceDate AS DATE) BETWEEN CAST(CONCAT(CASE WHEN  (MONTH(GETDATE()) - 7) <> 0  THEN  (MONTH(GETDATE()) - 7) ELSE  12 END,'/','01/', CASE WHEN  (MONTH(GETDATE()) - 7) <> 0  THEN  YEAR(GETDATE()) ELSE  (YEAR(GETDATE()) - 7) END) as date) AND GETDATE() */
			 AND F.Status=1
GROUP BY  dos.ServiceDate,F.PatientCode, F.AdmissionNumber, CUPS.Code,CUPS.Description, CUPS.CODE, HA.EntityType,ING.FECHEGRESO
),

CTE_NO_QUIRURGICOS
AS
(
SELECT DISTINCT ING.IPCODPACI, COUNT(ING.FECHEGRESO) EGRESOS, ING.CODDIAEGR, ING.FECHEGRESO, CASE WHEN HA.EntityType =1 THEN 'Contributivo' WHEN HA.EntityType= 2 THEN 'Subsidiado' WHEN HA.EntityType= 3 THEN 'Vinculados Municipios'
WHEN HA.EntityType= 4 THEN 'Vinculados Departamentos' WHEN HA.EntityType= 5 THEN 'ARL Riesgos Laborales' WHEN HA.EntityType= 6 THEN 'Medicina Prepagada'
WHEN HA.EntityType= 7 THEN 'IPS Privada' WHEN HA.EntityType= 8 THEN 'IPS Publica' WHEN HA.EntityType= 9 THEN 'Regimen Especial' 
WHEN HA.EntityType= 10 THEN 'Accidentes de transito' WHEN HA.EntityType= 11 THEN 'Fosyga' WHEN HA.EntityType= 12 THEN 'Otros' ELSE 'NO HAY DATO' END AS 'REGIMEN DE SALUD'
, CAST(ING.FECHEGRESO AS date) AS 'FECHA BUSQUEDA'
FROM ADINGRESO ING
INNER JOIN .Contract.HealthAdministrator AS HA WITH(NOLOCK) ON HA.Id=ING.GENCONENTITY
WHERE ING.CODDIAEGR NOT IN ('F000','F001','F002','F009','F010','F011','F012','F013','F018','F019','F020','F021','F022','F023','F024','F028','F03X','F04X','F050','F051',
'F058','F059','F060','F061','F062','F063','F064','F065','F066','F067','F068','F069','F070','F071','F072','F078','F079','F09X','F100','F101','F102','F103','F104',
'F105','F106','F107','F108','F109','F110','F111','F112','F113','F114','F115','F116','F117','F118','F119','F120','F121','F122','F123','F124','F125','F126','F127',
'F128','F129','F130','F131','F132','F133','F134','F135','F136','F137','F138','F139','F140','F141','F142','F143','F144','F145','F146','F147','F148','F149','F150',
'F151','F152','F153','F154','F155','F156','F157','F158','F159','F160','F161','F162','F163','F164','F165','F166','F167','F168','F169','F170','F171','F172','F173',
'F174','F175','F176','F177','F178','F179','F180','F181','F182','F183','F184','F185','F186','F187','F188','F189','F190','F191','F192','F193','F194','F195','F196',
'F197','F198','F199','F200','F201','F202','F203','F204','F205','F206','F208','F209','F21X','F220','F228','F229','F230','F231','F232','F233','F238','F239','F24X',
'F250','F251','F252','F258','F259','F28X','F29X','F300','F301','F302','F308','F309','F310','F311','F312','F313','F314','F315','F316','F317','F318','F319','F320',
'F321','F322','F323','F328','F329','F330','F331','F332','F333','F334','F338','F339','F340','F341','F348','F349','F380','F381','F388','F39X','F400','F401','F402','F408',
'F409','F410','F411','F412','F413','F418','F419','F420','F421','F422','F428','F429','F430','F431','F432','F438','F439','F440','F441','F442','F443','F444','F445',
'F446','F447','F448','F449','F450','F451','F452','F453','F454','F458','F459','F480','F481','F488','F489','F500','F501','F502','F503','F504','F505','F508','F509',
'F510','F511','F512','F513','F514','F515','F518','F519','F520','F521','F522','F523','F524','F525','F526','F527','F528','F529','F530','F531','F538','F539','F54X',
'F55X','F59X','F600','F601','F602','F603','F604','F605','F606','F607','F608','F609','F61X','F620','F621','F628','F629','F630','F631','F632','F633','F638','F639',
'F640','F641','F642','F648','F649','F650','F651','F652','F653','F654','F655','F656','F658','F659','F660','F661','F662','F668','F669','F680','F681','F688','F69X',
'F700','F701','F708','F709','F710','F711','F718','F719','F720','F721','F728','F729','F730','F731','F738','F739','F780','F781','F788','F789','F790','F791','F798',
'F799','F800','F801','F802','F803','F808','F809','F810','F811','F812','F813','F818','F819','F82X','F83X','F840','F841','F842','F843','F844','F845','F848','F849',
'F88X','F89X','F900','F901','F908','F909','F910','F911','F912','F913','F918','F919','F920','F928','F929','F930','F931','F932','F933','F938','F939','F940','F941',
'F942','F948','F949','F950','F951','F952','F958','F959','F980','F981','F982','F983','F984','F985','F986','F988','F989','F99X','O603','O60X','O800','O801','O808','O809','O810','O811','O812','O813','O814','O815',
'O828'',O829','O831','O832','O833','O834','O838','O839','O840','O841','O848','O849','O757','O820','O821','O822','O842')  
/*AND  CAST(ING.FECHEGRESO AS DATE) BETWEEN CAST(CONCAT(CASE WHEN  (MONTH(GETDATE()) - 7) <> 0  THEN  (MONTH(GETDATE()) - 7) ELSE  12 END,'/','01/', CASE WHEN  (MONTH(GETDATE()) - 7) <> 0  THEN  YEAR(GETDATE()) ELSE  (YEAR(GETDATE()) - 7) END) as date) AND GETDATE()*/
GROUP BY ING.IPCODPACI,ING.FECHEGRESO,ING.CODDIAEGR, HA.EntityType
),


CTE_SALUD_MENTAL
AS
(
SELECT DISTINCT ING.IPCODPACI, COUNT(ING.FECHEGRESO) EGRESOS, ING.CODDIAEGR, CASE WHEN HA.EntityType =1 THEN 'Contributivo' WHEN HA.EntityType= 2 THEN 'Subsidiado' WHEN HA.EntityType= 3 THEN 'Vinculados Municipios'
WHEN HA.EntityType= 4 THEN 'Vinculados Departamentos' WHEN HA.EntityType= 5 THEN 'ARL Riesgos Laborales' WHEN HA.EntityType= 6 THEN 'Medicina Prepagada'
WHEN HA.EntityType= 7 THEN 'IPS Privada' WHEN HA.EntityType= 8 THEN 'IPS Publica' WHEN HA.EntityType= 9 THEN 'Regimen Especial' 
WHEN HA.EntityType= 10 THEN 'Accidentes de transito' WHEN HA.EntityType= 11 THEN 'Fosyga' WHEN HA.EntityType= 12 THEN 'Otros' ELSE 'NO HAY DATO' END AS 'REGIMEN DE SALUD'
, CAST(ING.FECHEGRESO AS date) AS 'FECHA BUSQUEDA'
FROM ADINGRESO ING
INNER JOIN INDIAGNOS DIA WITH(NOLOCK) ON DIA.CODDIAGNO=ING.CODDIAEGR
INNER JOIN .Contract.HealthAdministrator AS HA WITH(NOLOCK) ON HA.Id=ING.GENCONENTITY
WHERE ING.CODDIAEGR IN ('F000','F001','F002','F009','F010','F011','F012','F013','F018','F019','F020','F021','F022','F023','F024','F028','F03X','F04X','F050','F051',
'F058','F059','F060','F061','F062','F063','F064','F065','F066','F067','F068','F069','F070','F071','F072','F078','F079','F09X','F100','F101','F102','F103','F104',
'F105','F106','F107','F108','F109','F110','F111','F112','F113','F114','F115','F116','F117','F118','F119','F120','F121','F122','F123','F124','F125','F126','F127',
'F128','F129','F130','F131','F132','F133','F134','F135','F136','F137','F138','F139','F140','F141','F142','F143','F144','F145','F146','F147','F148','F149','F150',
'F151','F152','F153','F154','F155','F156','F157','F158','F159','F160','F161','F162','F163','F164','F165','F166','F167','F168','F169','F170','F171','F172','F173',
'F174','F175','F176','F177','F178','F179','F180','F181','F182','F183','F184','F185','F186','F187','F188','F189','F190','F191','F192','F193','F194','F195','F196',
'F197','F198','F199','F200','F201','F202','F203','F204','F205','F206','F208','F209','F21X','F220','F228','F229','F230','F231','F232','F233','F238','F239','F24X',
'F250','F251','F252','F258','F259','F28X','F29X','F300','F301','F302','F308','F309','F310','F311','F312','F313','F314','F315','F316','F317','F318','F319','F320',
'F321','F322','F323','F328','F329','F330','F331','F332','F333','F334','F338','F339','F340','F341','F348','F349','F380','F381','F388','F39X','F400','F401','F402','F408',
'F409','F410','F411','F412','F413','F418','F419','F420','F421','F422','F428','F429','F430','F431','F432','F438','F439','F440','F441','F442','F443','F444','F445',
'F446','F447','F448','F449','F450','F451','F452','F453','F454','F458','F459','F480','F481','F488','F489','F500','F501','F502','F503','F504','F505','F508','F509',
'F510','F511','F512','F513','F514','F515','F518','F519','F520','F521','F522','F523','F524','F525','F526','F527','F528','F529','F530','F531','F538','F539','F54X',
'F55X','F59X','F600','F601','F602','F603','F604','F605','F606','F607','F608','F609','F61X','F620','F621','F628','F629','F630','F631','F632','F633','F638','F639',
'F640','F641','F642','F648','F649','F650','F651','F652','F653','F654','F655','F656','F658','F659','F660','F661','F662','F668','F669','F680','F681','F688','F69X',
'F700','F701','F708','F709','F710','F711','F718','F719','F720','F721','F728','F729','F730','F731','F738','F739','F780','F781','F788','F789','F790','F791','F798',
'F799','F800','F801','F802','F803','F808','F809','F810','F811','F812','F813','F818','F819','F82X','F83X','F840','F841','F842','F843','F844','F845','F848','F849',
'F88X','F89X','F900','F901','F908','F909','F910','F911','F912','F913','F918','F919','F920','F928','F929','F930','F931','F932','F933','F938','F939','F940','F941',
'F942','F948','F949','F950','F951','F952','F958','F959','F980','F981','F982','F983','F984','F985','F986','F988','F989','F99X')  
--AND  CAST(ING.FECHEGRESO AS DATE) BETWEEN CAST(CONCAT(CASE WHEN  (MONTH(GETDATE()) - 7) <> 0  THEN  (MONTH(GETDATE()) - 7) ELSE  12 END,'/','01/', CASE WHEN  (MONTH(GETDATE()) - 7) <> 0  THEN  YEAR(GETDATE()) ELSE  (YEAR(GETDATE()) - 7) END) as date) AND GETDATE()
GROUP BY ING.IPCODPACI,ING.FECHEGRESO,ING.CODDIAEGR, HA.EntityType
),

CTE_OBSERVACIONES
AS
(
SELECT DISTINCT ING.IPCODPACI, COUNT(ING.UFUCODIGO) UNIDADFUNCIONAL, FUN.UFUDESCRI, ING.FECHOSPIT, CASE WHEN HA.EntityType =1 THEN 'Contributivo' WHEN HA.EntityType= 2 THEN 'Subsidiado' WHEN HA.EntityType= 3 THEN 'Vinculados Municipios'
WHEN HA.EntityType= 4 THEN 'Vinculados Departamentos' WHEN HA.EntityType= 5 THEN 'ARL Riesgos Laborales' WHEN HA.EntityType= 6 THEN 'Medicina Prepagada'
WHEN HA.EntityType= 7 THEN 'IPS Privada' WHEN HA.EntityType= 8 THEN 'IPS Publica' WHEN HA.EntityType= 9 THEN 'Regimen Especial' 
WHEN HA.EntityType= 10 THEN 'Accidentes de transito' WHEN HA.EntityType= 11 THEN 'Fosyga' WHEN HA.EntityType= 12 THEN 'Otros' ELSE 'NO HAY DATO' END AS 'REGIMEN DE SALUD'
, CAST(ING.FECHEGRESO AS date) AS 'FECHA BUSQUEDA'
FROM ADINGRESO ING
LEFT JOIN INUNIFUNC AS FUN WITH(NOLOCK) ON FUN.UFUCODIGO=ING.UFUCODIGO
INNER JOIN .Contract.HealthAdministrator AS HA WITH(NOLOCK) ON HA.Id=ING.GENCONENTITY

WHERE ING.FECHOSPIT IS NOT NULL  
/*AND  CAST(ING.FECHEGRESO AS DATE) BETWEEN CAST(CONCAT(CASE WHEN  (MONTH(GETDATE()) - 7) <> 0  THEN  (MONTH(GETDATE()) - 7) ELSE  12 END,'/','01/', CASE WHEN  (MONTH(GETDATE()) - 7) <> 0  THEN  YEAR(GETDATE()) ELSE  (YEAR(GETDATE()) - 7) END) as date) AND GETDATE()*/
GROUP BY ING.IPCODPACI, ING.UFUCODIGO, FUN.UFUDESCRI, ING.FECHOSPIT, HA.EntityType,CAST(ING.FECHEGRESO AS date)
),

CTE_DIAS_ESTANCIA_OBSTETRICOS
AS
(

SELECT DISTINCT F.PatientCode, F.AdmissionNumber, dos.ServiceDate,CUPS.Code,CUPS.Description, DATEDIFF(DAY,ING.IFECHAING,dos.ServiceDate) AS 'DIAS ESTANCIA',ING.IFECHAING, CASE WHEN HA.EntityType =1 THEN 'Contributivo' WHEN HA.EntityType= 2 THEN 'Subsidiado' WHEN HA.EntityType= 3 THEN 'Vinculados Municipios'
WHEN HA.EntityType= 4 THEN 'Vinculados Departamentos' WHEN HA.EntityType= 5 THEN 'ARL Riesgos Laborales' WHEN HA.EntityType= 6 THEN 'Medicina Prepagada'
WHEN HA.EntityType= 7 THEN 'IPS Privada' WHEN HA.EntityType= 8 THEN 'IPS Publica' WHEN HA.EntityType= 9 THEN 'Regimen Especial' 
WHEN HA.EntityType= 10 THEN 'Accidentes de transito' WHEN HA.EntityType= 11 THEN 'Fosyga' WHEN HA.EntityType= 12 THEN 'Otros' ELSE 'NO HAY DATO' END AS 'REGIMEN DE SALUD'  
, CAST(DOS.ServiceDate AS date) AS 'FECHA BUSQUEDA'
 FROM   BILLING.INVOICE AS F WITH (NOLOCK) 
		   INNER JOIN BILLING.INVOICEDETAIL AS DF WITH (NOLOCK) ON DF.INVOICEID = F.ID 
		   INNER JOIN BILLING.REVENUECONTROLDETAIL RCD WITH (NOLOCK) ON RCD.ID = F.REVENUECONTROLDETAILID 
		   INNER JOIN DBO.ADINGRESO AS ING WITH (NOLOCK) ON ING.NUMINGRES = F.ADMISSIONNUMBER 
		   INNER JOIN DBO.ADCENATEN AS CEN WITH (NOLOCK) ON CEN.CODCENATE = ING.CODCENATE 
		   INNER JOIN BILLING.SERVICEORDERDETAIL AS DOS WITH (NOLOCK) ON DOS.ID = DF.SERVICEORDERDETAILID
		   LEFT OUTER JOIN CONTRACT.CUPSENTITY AS CUPS WITH (NOLOCK) ON CUPS.ID = DOS.CUPSENTITYID
		   INNER JOIN .Contract.HealthAdministrator AS HA WITH(NOLOCK) ON HA.Id=ING.GENCONENTITY
	WHERE CUPS.CODE IN ('721003','732201','735301','735930','735931','735980','740001','740002','740003')
		     /*AND CAST(DOS.ServiceDate AS DATE)  BETWEEN '2021/07/01' AND  '2021/09/30'*/ AND F.Status=1
GROUP BY  dos.ServiceDate,F.PatientCode, F.AdmissionNumber, CUPS.Code,CUPS.Description, CUPS.CODE, HA.EntityType,ING.IFECHAING


),

CTE_DIAS_ESTANCIA_NOQX
AS
(
SELECT DISTINCT ING.IPCODPACI, ING.CODDIAEGR,ING.IFECHAING, ING.FECHEGRESO, DATEDIFF(DAY,ING.IFECHAING, ING.FECHEGRESO) AS 'DIAS ESTANCIA NO QX', CASE WHEN HA.EntityType =1 THEN 'Contributivo' WHEN HA.EntityType= 2 THEN 'Subsidiado' WHEN HA.EntityType= 3 THEN 'Vinculados Municipios'
WHEN HA.EntityType= 4 THEN 'Vinculados Departamentos' WHEN HA.EntityType= 5 THEN 'ARL Riesgos Laborales' WHEN HA.EntityType= 6 THEN 'Medicina Prepagada'
WHEN HA.EntityType= 7 THEN 'IPS Privada' WHEN HA.EntityType= 8 THEN 'IPS Publica' WHEN HA.EntityType= 9 THEN 'Regimen Especial' 
WHEN HA.EntityType= 10 THEN 'Accidentes de transito' WHEN HA.EntityType= 11 THEN 'Fosyga' WHEN HA.EntityType= 12 THEN 'Otros' ELSE 'NO HAY DATO' END AS 'REGIMEN DE SALUD'
, CAST(ING.FECHEGRESO AS date) AS 'FECHA BUSQUEDA'
FROM ADINGRESO ING
INNER JOIN INDIAGNOS DIA WITH(NOLOCK) ON DIA.CODDIAGNO=ING.CODDIAEGR
INNER JOIN .Contract.HealthAdministrator AS HA WITH(NOLOCK) ON HA.Id=ING.GENCONENTITY

WHERE ING.FECHEGRESO IS NOT NULL AND ING.CODDIAEGR NOT IN ('F000','F001','F002','F009','F010','F011','F012','F013','F018','F019','F020','F021','F022','F023','F024','F028','F03X','F04X','F050','F051',
'F058','F059','F060','F061','F062','F063','F064','F065','F066','F067','F068','F069','F070','F071','F072','F078','F079','F09X','F100','F101','F102','F103','F104',
'F105','F106','F107','F108','F109','F110','F111','F112','F113','F114','F115','F116','F117','F118','F119','F120','F121','F122','F123','F124','F125','F126','F127',
'F128','F129','F130','F131','F132','F133','F134','F135','F136','F137','F138','F139','F140','F141','F142','F143','F144','F145','F146','F147','F148','F149','F150',
'F151','F152','F153','F154','F155','F156','F157','F158','F159','F160','F161','F162','F163','F164','F165','F166','F167','F168','F169','F170','F171','F172','F173',
'F174','F175','F176','F177','F178','F179','F180','F181','F182','F183','F184','F185','F186','F187','F188','F189','F190','F191','F192','F193','F194','F195','F196',
'F197','F198','F199','F200','F201','F202','F203','F204','F205','F206','F208','F209','F21X','F220','F228','F229','F230','F231','F232','F233','F238','F239','F24X',
'F250','F251','F252','F258','F259','F28X','F29X','F300','F301','F302','F308','F309','F310','F311','F312','F313','F314','F315','F316','F317','F318','F319','F320',
'F321','F322','F323','F328','F329','F330','F331','F332','F333','F334','F338','F339','F340','F341','F348','F349','F380','F381','F388','F39X','F400','F401','F402','F408',
'F409','F410','F411','F412','F413','F418','F419','F420','F421','F422','F428','F429','F430','F431','F432','F438','F439','F440','F441','F442','F443','F444','F445',
'F446','F447','F448','F449','F450','F451','F452','F453','F454','F458','F459','F480','F481','F488','F489','F500','F501','F502','F503','F504','F505','F508','F509',
'F510','F511','F512','F513','F514','F515','F518','F519','F520','F521','F522','F523','F524','F525','F526','F527','F528','F529','F530','F531','F538','F539','F54X',
'F55X','F59X','F600','F601','F602','F603','F604','F605','F606','F607','F608','F609','F61X','F620','F621','F628','F629','F630','F631','F632','F633','F638','F639',
'F640','F641','F642','F648','F649','F650','F651','F652','F653','F654','F655','F656','F658','F659','F660','F661','F662','F668','F669','F680','F681','F688','F69X',
'F700','F701','F708','F709','F710','F711','F718','F719','F720','F721','F728','F729','F730','F731','F738','F739','F780','F781','F788','F789','F790','F791','F798',
'F799','F800','F801','F802','F803','F808','F809','F810','F811','F812','F813','F818','F819','F82X','F83X','F840','F841','F842','F843','F844','F845','F848','F849',
'F88X','F89X','F900','F901','F908','F909','F910','F911','F912','F913','F918','F919','F920','F928','F929','F930','F931','F932','F933','F938','F939','F940','F941',
'F942','F948','F949','F950','F951','F952','F958','F959','F980','F981','F982','F983','F984','F985','F986','F988','F989','F99X','O603','O60X','O800','O801','O808','O809','O810','O811','O812','O813','O814','O815',
              'O828'',O829','O831','O832','O833','O834','O838','O839','O840','O841','O848','O849','O757','O820','O821','O822','O842')  
			  /*AND  CAST(ING.FECHEGRESO AS DATE) BETWEEN CAST(CONCAT(CASE WHEN  (MONTH(GETDATE()) - 7) <> 0  THEN  (MONTH(GETDATE()) - 7) ELSE  12 END,'/','01/', CASE WHEN  (MONTH(GETDATE()) - 7) <> 0  THEN  YEAR(GETDATE()) ELSE  (YEAR(GETDATE()) - 7) END) as date) AND GETDATE()*/
GROUP BY ING.IPCODPACI,ING.FECHEGRESO,ING.IFECHAING, ING.CODDIAEGR, HA.EntityType
),

CTE_DIAS_ESTANCIA_SM
AS
(
SELECT DISTINCT ING.IPCODPACI,  ING.CODDIAEGR, ING.IFECHAING, ING.FECHEGRESO, DATEDIFF(DAY,ING.IFECHAING, ING.FECHEGRESO) 'DIAS ESTANCIA SM', CASE WHEN HA.EntityType =1 THEN 'Contributivo' WHEN HA.EntityType= 2 THEN 'Subsidiado' WHEN HA.EntityType= 3 THEN 'Vinculados Municipios'
WHEN HA.EntityType= 4 THEN 'Vinculados Departamentos' WHEN HA.EntityType= 5 THEN 'ARL Riesgos Laborales' WHEN HA.EntityType= 6 THEN 'Medicina Prepagada'
WHEN HA.EntityType= 7 THEN 'IPS Privada' WHEN HA.EntityType= 8 THEN 'IPS Publica' WHEN HA.EntityType= 9 THEN 'Regimen Especial' 
WHEN HA.EntityType= 10 THEN 'Accidentes de transito' WHEN HA.EntityType= 11 THEN 'Fosyga' WHEN HA.EntityType= 12 THEN 'Otros' ELSE 'NO HAY DATO' END AS 'REGIMEN DE SALUD'
, CAST(ING.FECHEGRESO AS date) AS 'FECHA BUSQUEDA'
FROM ADINGRESO ING
INNER JOIN INDIAGNOS DIA WITH(NOLOCK) ON DIA.CODDIAGNO=ING.CODDIAEGR
INNER JOIN .Contract.HealthAdministrator AS HA WITH(NOLOCK) ON HA.Id=ING.GENCONENTITY

WHERE ING.FECHEGRESO IS NOT NULL AND ING.CODDIAEGR IN ('F000','F001','F002','F009','F010','F011','F012','F013','F018','F019','F020','F021','F022','F023','F024','F028','F03X','F04X','F050','F051',
'F058','F059','F060','F061','F062','F063','F064','F065','F066','F067','F068','F069','F070','F071','F072','F078','F079','F09X','F100','F101','F102','F103','F104',
'F105','F106','F107','F108','F109','F110','F111','F112','F113','F114','F115','F116','F117','F118','F119','F120','F121','F122','F123','F124','F125','F126','F127',
'F128','F129','F130','F131','F132','F133','F134','F135','F136','F137','F138','F139','F140','F141','F142','F143','F144','F145','F146','F147','F148','F149','F150',
'F151','F152','F153','F154','F155','F156','F157','F158','F159','F160','F161','F162','F163','F164','F165','F166','F167','F168','F169','F170','F171','F172','F173',
'F174','F175','F176','F177','F178','F179','F180','F181','F182','F183','F184','F185','F186','F187','F188','F189','F190','F191','F192','F193','F194','F195','F196',
'F197','F198','F199','F200','F201','F202','F203','F204','F205','F206','F208','F209','F21X','F220','F228','F229','F230','F231','F232','F233','F238','F239','F24X',
'F250','F251','F252','F258','F259','F28X','F29X','F300','F301','F302','F308','F309','F310','F311','F312','F313','F314','F315','F316','F317','F318','F319','F320',
'F321','F322','F323','F328','F329','F330','F331','F332','F333','F334','F338','F339','F340','F341','F348','F349','F380','F381','F388','F39X','F400','F401','F402','F408',
'F409','F410','F411','F412','F413','F418','F419','F420','F421','F422','F428','F429','F430','F431','F432','F438','F439','F440','F441','F442','F443','F444','F445',
'F446','F447','F448','F449','F450','F451','F452','F453','F454','F458','F459','F480','F481','F488','F489','F500','F501','F502','F503','F504','F505','F508','F509',
'F510','F511','F512','F513','F514','F515','F518','F519','F520','F521','F522','F523','F524','F525','F526','F527','F528','F529','F530','F531','F538','F539','F54X',
'F55X','F59X','F600','F601','F602','F603','F604','F605','F606','F607','F608','F609','F61X','F620','F621','F628','F629','F630','F631','F632','F633','F638','F639',
'F640','F641','F642','F648','F649','F650','F651','F652','F653','F654','F655','F656','F658','F659','F660','F661','F662','F668','F669','F680','F681','F688','F69X',
'F700','F701','F708','F709','F710','F711','F718','F719','F720','F721','F728','F729','F730','F731','F738','F739','F780','F781','F788','F789','F790','F791','F798',
'F799','F800','F801','F802','F803','F808','F809','F810','F811','F812','F813','F818','F819','F82X','F83X','F840','F841','F842','F843','F844','F845','F848','F849',
'F88X','F89X','F900','F901','F908','F909','F910','F911','F912','F913','F918','F919','F920','F928','F929','F930','F931','F932','F933','F938','F939','F940','F941',
'F942','F948','F949','F950','F951','F952','F958','F959','F980','F981','F982','F983','F984','F985','F986','F988','F989','F99X')  
/*AND  CAST(ING.FECHEGRESO AS DATE) BETWEEN CAST(CONCAT(CASE WHEN  (MONTH(GETDATE()) - 7) <> 0  THEN  (MONTH(GETDATE()) - 7) ELSE  12 END,'/','01/', CASE WHEN  (MONTH(GETDATE()) - 7) <> 0  THEN  YEAR(GETDATE()) ELSE  (YEAR(GETDATE()) - 7) END) as date) AND GETDATE()*/
GROUP BY ING.IPCODPACI,ING.FECHEGRESO,ING.CODDIAEGR, ING.IFECHAING, ING.FECHEGRESO, HA.EntityType
),

CTE_LABORATORIOS
AS 
(
SELECT DISTINCT LAB.IPCODPACI, LAB.ESTSERIPS,  LAB.CODSERIPS, CUPS.DESCODCUPS, LAB.FECORDMED, LAB.CANSERIPS CANTIDAD, CASE WHEN HA.EntityType =1 THEN 'Contributivo' WHEN HA.EntityType= 2 THEN 'Subsidiado' WHEN HA.EntityType= 3 THEN 'Vinculados Municipios'
WHEN HA.EntityType= 4 THEN 'Vinculados Departamentos' WHEN HA.EntityType= 5 THEN 'ARL Riesgos Laborales' WHEN HA.EntityType= 6 THEN 'Medicina Prepagada'
WHEN HA.EntityType= 7 THEN 'IPS Privada' WHEN HA.EntityType= 8 THEN 'IPS Publica' WHEN HA.EntityType= 9 THEN 'Regimen Especial' 
WHEN HA.EntityType= 10 THEN 'Accidentes de transito' WHEN HA.EntityType= 11 THEN 'Fosyga' WHEN HA.EntityType= 12 THEN 'Otros' ELSE 'NO HAY DATO' END AS 'REGIMEN DE SALUD'
, CAST(LAB.FECORDMED AS date) AS 'FECHA BUSQUEDA'
FROM AMBORDLAB LAB
LEFT JOIN INCUPSIPS AS CUPS WITH(NOLOCK) ON CUPS.CODSERIPS=LAB.CODSERIPS
INNER JOIN ADINGRESO AS ING WITH(NOLOCK) ON ING.IPCODPACI=LAB.IPCODPACI
INNER JOIN .Contract.HealthAdministrator AS HA WITH(NOLOCK) ON HA.Id=ING.GENCONENTITY

WHERE LAB.ESTSERIPS NOT IN ('1','5','6')  
/*AND  CAST(LAB.FECORDMED AS DATE) BETWEEN CAST(CONCAT(CASE WHEN  (MONTH(GETDATE()) - 7) <> 0  THEN  (MONTH(GETDATE()) - 7) ELSE  12 END,'/','01/', CASE WHEN  (MONTH(GETDATE()) - 7) <> 0  THEN  YEAR(GETDATE()) ELSE  (YEAR(GETDATE()) - 7) END) as date) AND GETDATE()*/
GROUP BY LAB.IPCODPACI,  LAB.CODSERIPS, CUPS.DESCODCUPS, LAB.ESTSERIPS, LAB.FECORDMED, LAB.CANSERIPS, HA.EntityType

UNION

SELECT DISTINCT LAB.IPCODPACI, LAB.ESTSERIPS,  LAB.CODSERIPS, CUPS.DESCODCUPS, LAB.FECORDMED, LAB.CANSERIPS CANTIDAD, CASE WHEN HA.EntityType =1 THEN 'Contributivo' WHEN HA.EntityType= 2 THEN 'Subsidiado' WHEN HA.EntityType= 3 THEN 'Vinculados Municipios'
WHEN HA.EntityType= 4 THEN 'Vinculados Departamentos' WHEN HA.EntityType= 5 THEN 'ARL Riesgos Laborales' WHEN HA.EntityType= 6 THEN 'Medicina Prepagada'
WHEN HA.EntityType= 7 THEN 'IPS Privada' WHEN HA.EntityType= 8 THEN 'IPS Publica' WHEN HA.EntityType= 9 THEN 'Regimen Especial' 
WHEN HA.EntityType= 10 THEN 'Accidentes de transito' WHEN HA.EntityType= 11 THEN 'Fosyga' WHEN HA.EntityType= 12 THEN 'Otros' ELSE 'NO HAY DATO' END AS 'REGIMEN DE SALUD'
, CAST(LAB.FECORDMED AS date) AS 'FECHA BUSQUEDA'

FROM AMBORDLAB LAB
LEFT JOIN INCUPSIPS AS CUPS WITH(NOLOCK) ON CUPS.CODSERIPS=LAB.CODSERIPS
INNER JOIN ADINGRESO AS ING WITH(NOLOCK) ON ING.IPCODPACI=LAB.IPCODPACI
INNER JOIN .Contract.HealthAdministrator AS HA WITH(NOLOCK) ON HA.Id=ING.GENCONENTITY

WHERE LAB.ESTSERIPS NOT IN ('1','5','6') 
/*AND  CAST(LAB.FECORDMED AS DATE) BETWEEN CAST(CONCAT(CASE WHEN  (MONTH(GETDATE()) - 7) <> 0  THEN  (MONTH(GETDATE()) - 7) ELSE  12 END,'/','01/', CASE WHEN  (MONTH(GETDATE()) - 7) <> 0  THEN  YEAR(GETDATE()) ELSE  (YEAR(GETDATE()) - 7) END) as date) AND GETDATE()*/
GROUP BY LAB.IPCODPACI,  LAB.CODSERIPS, CUPS.DESCODCUPS, LAB.ESTSERIPS, LAB.FECORDMED, LAB.CANSERIPS, HA.EntityType
),

CTE_IMAGENES
AS
(
SELECT DISTINCT F.PatientCode, F.AdmissionNumber, dos.ServiceDate,CUPS.Code,CUPS.Description, ING.IFECHAING, 1 CANTIDAD,CASE WHEN HA.EntityType =1 THEN 'Contributivo' WHEN HA.EntityType= 2 THEN 'Subsidiado' WHEN HA.EntityType= 3 THEN 'Vinculados Municipios'
WHEN HA.EntityType= 4 THEN 'Vinculados Departamentos' WHEN HA.EntityType= 5 THEN 'ARL Riesgos Laborales' WHEN HA.EntityType= 6 THEN 'Medicina Prepagada'
WHEN HA.EntityType= 7 THEN 'IPS Privada' WHEN HA.EntityType= 8 THEN 'IPS Publica' WHEN HA.EntityType= 9 THEN 'Regimen Especial' 
WHEN HA.EntityType= 10 THEN 'Accidentes de transito' WHEN HA.EntityType= 11 THEN 'Fosyga' WHEN HA.EntityType= 12 THEN 'Otros' ELSE 'NO HAY DATO' END AS 'REGIMEN DE SALUD'  
, CAST(DOS.ServiceDate AS date) AS 'FECHA BUSQUEDA'
 FROM   BILLING.INVOICE AS F WITH (NOLOCK) 
		   INNER JOIN BILLING.INVOICEDETAIL AS DF WITH (NOLOCK) ON DF.INVOICEID = F.ID 
		   INNER JOIN BILLING.REVENUECONTROLDETAIL RCD WITH (NOLOCK) ON RCD.ID = F.REVENUECONTROLDETAILID 
		   INNER JOIN DBO.ADINGRESO AS ING WITH (NOLOCK) ON ING.NUMINGRES = F.ADMISSIONNUMBER 
		   INNER JOIN DBO.ADCENATEN AS CEN WITH (NOLOCK) ON CEN.CODCENATE = ING.CODCENATE 
		   INNER JOIN BILLING.SERVICEORDERDETAIL AS DOS WITH (NOLOCK) ON DOS.ID = DF.SERVICEORDERDETAILID
		   LEFT OUTER JOIN CONTRACT.CUPSENTITY AS CUPS WITH (NOLOCK) ON CUPS.ID = DOS.CUPSENTITYID
		   INNER JOIN .Contract.HealthAdministrator AS HA WITH(NOLOCK) ON HA.Id=ING.GENCONENTITY
	WHERE CUPS.CODE IN ('870001','870003','870004','870005','870007','870101','870102','870103','870104','870105','870107','870108','870112','870113','870131','870440','870450','870451','870452','870453','870454','870455','870601',
'870602','870603','871010','871019','871020','871030','871040','871050','871091','871111','871112','871121','871129','871320','872002','873111','873112','873121','873122','873123','873202','873204','873205','873206','873210','873311',
'873312','873313','873314','873333','873335','873340','873411','873412','873420','873422','873431','873443','870006','870114','870456','870460','871060','871061','871062','871070','871208','872011','872101','872102','872103','872104',
'872105','872121','872122','872123','873001','873002','873003','873004','873302','873303','873304','873305','873306','873308','873444','876260','887001','873423','881431','881432','881435','881436','881437')
		     /*AND CAST(DOS.ServiceDate AS DATE)  BETWEEN CAST(CONCAT(CASE WHEN  (MONTH(GETDATE()) - 7) <> 0  THEN  (MONTH(GETDATE()) - 7) ELSE  12 END,'/','01/', CASE WHEN  (MONTH(GETDATE()) - 7) <> 0  THEN  YEAR(GETDATE()) ELSE  (YEAR(GETDATE()) - 7) END) as date) AND GETDATE() */ AND F.Status=1
GROUP BY  dos.ServiceDate,F.PatientCode, F.AdmissionNumber, CUPS.Code,CUPS.Description, CUPS.CODE, HA.EntityType,ING.IFECHAING
),

CTE_FISIOTERAPIA
AS
(
 SELECT F.PatientCode, F.InvoiceDate,RV.FolioQuantity CANTIDAD ,f.InvoiceNumber, SO.Code,CASE WHEN HA.EntityType =1 THEN 'Contributivo' WHEN HA.EntityType= 2 THEN 'Subsidiado' WHEN HA.EntityType= 3 THEN 'Vinculados Municipios'
WHEN HA.EntityType= 4 THEN 'Vinculados Departamentos' WHEN HA.EntityType= 5 THEN 'ARL Riesgos Laborales' WHEN HA.EntityType= 6 THEN 'Medicina Prepagada'
WHEN HA.EntityType= 7 THEN 'IPS Privada' WHEN HA.EntityType= 8 THEN 'IPS Publica' WHEN HA.EntityType= 9 THEN 'Regimen Especial' 
WHEN HA.EntityType= 10 THEN 'Accidentes de transito' WHEN HA.EntityType= 11 THEN 'Fosyga' WHEN HA.EntityType= 12 THEN 'Otros' ELSE 'NO HAY DATO' END AS 'REGIMEN DE SALUD' 
, CAST(F.InvoiceDate AS date) AS 'FECHA BUSQUEDA'
  FROM   BILLING.INVOICE AS F WITH (NOLOCK) 
		   INNER JOIN BILLING.INVOICEDETAIL AS DF WITH (NOLOCK) ON DF.INVOICEID = F.ID 
		   INNER JOIN BILLING.REVENUECONTROLDETAIL RCD WITH (NOLOCK) ON RCD.ID = F.REVENUECONTROLDETAILID
		   INNER JOIN Billing.REVENUECONTROL AS RV WITH(NOLOCK) ON RV.AdmissionNumber=f.AdmissionNumber
		   INNER JOIN DBO.ADINGRESO AS ING WITH (NOLOCK) ON ING.NUMINGRES = F.ADMISSIONNUMBER 
		   INNER JOIN DBO.ADCENATEN AS CEN WITH (NOLOCK) ON CEN.CODCENATE = ING.CODCENATE 
		   INNER JOIN BILLING.SERVICEORDERDETAIL AS DOS WITH (NOLOCK) ON DOS.ID = DF.SERVICEORDERDETAILID
		   INNER JOIN BILLING.SERVICEORDER AS SO WITH(NOLOCK) ON SO.ID=DOS.ServiceOrderId
		   LEFT OUTER JOIN CONTRACT.CUPSENTITY AS CUPS WITH (NOLOCK) ON CUPS.ID = DOS.CUPSENTITYID
		  INNER JOIN .Contract.HealthAdministrator AS HA WITH(NOLOCK) ON HA.Id=ING.GENCONENTITY
		   WHERE CUPS.Code ='931001' AND F.Status =1 
		   /*AND DOS.ServiceDate  BETWEEN CAST(CONCAT(CASE WHEN  (MONTH(GETDATE()) - 7) <> 0  THEN  (MONTH(GETDATE()) - 7) ELSE  12 END,'/','01/', CASE WHEN  (MONTH(GETDATE()) - 7) <> 0  THEN  YEAR(GETDATE()) ELSE  (YEAR(GETDATE()) - 7) END) as date) AND GETDATE()*/
		   group by F.PatientCode, DF.InvoicedQuantity, HA.EntityType, rv.FolioQuantity, f.InvoiceNumber, SO.Code, F.InvoiceDate
)
,
CTE_RES2193
AS
(
Select 'DOSIS DE BIOLOGICO APLICADAS' VARIABLE ,[REGIMEN DE SALUD],Sum(APLICADA) CANTIDAD, [FECHA BUSQUEDA]  from CTE_VACUNAS group BY [REGIMEN DE SALUD], [FECHA BUSQUEDA]
union all
SELECT 'CONTROLES DE ENFERMERIA (PRENATAL,CYD)',[REGIMEN DE SALUD],Sum(NUMEROCONS) CANTIDAD, [FECHA BUSQUEDA] from CTE_CONS_ENFERMERIA group BY [REGIMEN DE SALUD], [FECHA BUSQUEDA]
UNION ALL
SELECT 'OTROS CONTROLES DE ENFERMERIA PYP (DIFERENTES A PRENATAL,CYD)', [REGIMEN DE SALUD],SUM(NUMEROCONS), [FECHA BUSQUEDA]  from CTE_CONS_NOENFERMERIA group BY [REGIMEN DE SALUD], [FECHA BUSQUEDA]
UNION ALL
SELECT 'CIT. CERVICOVAGINALES TOMADAS', [REGIMEN DE SALUD],SUM(CANTIDAD), [FECHA BUSQUEDA]  from CTE_FACTURACION_CITOLOGIAS group BY [REGIMEN DE SALUD], [FECHA BUSQUEDA]
UNION ALL
SELECT 'CONSULTAS DE MED. GRAL. ELECTIVAS REALIZADAS',[REGIMEN DE SALUD], SUM(NUMEROCONS), [FECHA BUSQUEDA] FROM CTE_CONS_MEDELECTIVAS group BY [REGIMEN DE SALUD], [FECHA BUSQUEDA]
UNION ALL
SELECT 'CONSULTAS DE MED. GRAL. URGENTES REALIZADAS', [REGIMEN DE SALUD],SUM(NUMEROCONS), [FECHA BUSQUEDA] FROM CTE_CONS_MEDURGENC group BY [REGIMEN DE SALUD], [FECHA BUSQUEDA]
UNION ALL
SELECT 'CONSULTAS DE MED. ESP. ELECTIVAS REALIZADAS', [REGIMEN DE SALUD],SUM(CONSULTAS), [FECHA BUSQUEDA] FROM CTE_CONS_ESPEC_ELECTIVAS group BY [REGIMEN DE SALUD], [FECHA BUSQUEDA]
UNION ALL
SELECT 'CONSULTAS DE MED. ESP. URGENTES REALIZADAS', [REGIMEN DE SALUD],ISNULL(SUM(CONSULTAS),'0'), [FECHA BUSQUEDA] FROM CTE_CONS_ESPEC_URGENTES group BY [REGIMEN DE SALUD], [FECHA BUSQUEDA]
UNION ALL
SELECT 'CONSULTAS ELECTIVAS REALIZADAS OTRAS PROFESIONES', [REGIMEN DE SALUD],ISNULL(SUM(CONSULTAS),'0'), [FECHA BUSQUEDA] FROM CTE_OTRAS_CONSULTAS_ELECTIVAS group BY [REGIMEN DE SALUD], [FECHA BUSQUEDA]
UNION ALL
SELECT 'CONSULTAS URGENTES REALIZADAS OTRAS PROFESIONES',[REGIMEN DE SALUD], ISNULL(SUM(CONSULTAS),'0'), [FECHA BUSQUEDA] FROM CTE_OTRAS_CONSULTAS_URGENTES group BY [REGIMEN DE SALUD], [FECHA BUSQUEDA]
UNION ALL
SELECT 'CONSULTAS ODONTOLOGIA (VALORACION)', [REGIMEN DE SALUD],SUM(CANTIDAD), [FECHA BUSQUEDA] FROM CTE_ODONTOLOGIA_VALORACION group BY [REGIMEN DE SALUD], [FECHA BUSQUEDA]
UNION ALL
SELECT 'NUMERO SESIONES ODONTOLOGIA', [REGIMEN DE SALUD],SUM(CANTIDAD), [FECHA BUSQUEDA] FROM CTE_ODONTOLOGIA_SESIONES group BY [REGIMEN DE SALUD], [FECHA BUSQUEDA]
UNION ALL
SELECT 'TOTAL TRATAMIENTO TERMINADOS', [REGIMEN DE SALUD],SUM(CANTIDAD) , [FECHA BUSQUEDA] FROM CTE_TRATAMIENTOS_TERMINADOS group BY [REGIMEN DE SALUD], [FECHA BUSQUEDA]
UNION ALL
SELECT 'SELLANTES APLICADOS',[REGIMEN DE SALUD],SUM(CANTIDAD) CANTIDAD, [FECHA BUSQUEDA] FROM CTE_FACTURACION_SELLANTES group BY [REGIMEN DE SALUD], [FECHA BUSQUEDA]
UNION ALL
SELECT 'SUPERFICIES OBTURADAS', [REGIMEN DE SALUD],SUM(APLICADOS), [FECHA BUSQUEDA] FROM CTE_SUPERFICIES group BY [REGIMEN DE SALUD], [FECHA BUSQUEDA]
UNION ALL
SELECT 'EXODONCIAS', [REGIMEN DE SALUD],SUM(REALIZADAS), [FECHA BUSQUEDA] FROM CTE_EXODONCIAS group BY [REGIMEN DE SALUD], [FECHA BUSQUEDA]
UNION ALL
SELECT 'PARTOS VAGINALES', [REGIMEN DE SALUD],ISNULL(SUM(PARTOS),'0'), [FECHA BUSQUEDA] FROM CTE_PARTOS_VAGINAL group BY [REGIMEN DE SALUD], [FECHA BUSQUEDA]
UNION ALL
SELECT 'PARTOS CESAREAS', [REGIMEN DE SALUD],ISNULL(SUM(CESAREAS),'0'), [FECHA BUSQUEDA] FROM CTE_PARTOS_CESAREA group BY [REGIMEN DE SALUD], [FECHA BUSQUEDA]
UNION ALL
SELECT 'EGRESOS OBSTETRICOS', [REGIMEN DE SALUD],ISNULL(SUM(EGRESOS),'0'), [FECHA BUSQUEDA]  FROM CTE_EGRESOS_OBSTETRICOS group BY [REGIMEN DE SALUD], [FECHA BUSQUEDA]
UNION ALL
SELECT 'EGRESOS QUIRURGICOS','', '0' , CAST(GETDATE() AS date) AS 'FECHA BUSQUEDA'
UNION ALL
SELECT 'EGRESOS NO QUIRURGICOS', [REGIMEN DE SALUD],SUM(EGRESOS), [FECHA BUSQUEDA]  FROM CTE_NO_QUIRURGICOS group BY [REGIMEN DE SALUD], [FECHA BUSQUEDA]
UNION ALL 
SELECT 'EGRESOS SALUD MENTAL', [REGIMEN DE SALUD],SUM(EGRESOS), [FECHA BUSQUEDA]  FROM CTE_SALUD_MENTAL group BY [REGIMEN DE SALUD], [FECHA BUSQUEDA]
UNION ALL
SELECT 'PACIENTES EN OBSERVACION', [REGIMEN DE SALUD],SUM(UNIDADFUNCIONAL) , [FECHA BUSQUEDA] FROM CTE_OBSERVACIONES group BY [REGIMEN DE SALUD], [FECHA BUSQUEDA]
UNION ALL
SELECT 'PACIENTES EN CUIDADOS INTERMEDIOS','', '0', CAST(GETDATE() AS date) AS 'FECHA BUSQUEDA'
UNION ALL
SELECT 'PACIENTES EN CUIDADOS INTENSIVOS', '','0', CAST(GETDATE() AS date) AS 'FECHA BUSQUEDA'
UNION ALL
SELECT 'DIAS DE ESTANCIA EGRESOS OBSTETRICOS', [REGIMEN DE SALUD],SUM([DIAS ESTANCIA]) , [FECHA BUSQUEDA] FROM CTE_DIAS_ESTANCIA_OBSTETRICOS group BY [REGIMEN DE SALUD], [FECHA BUSQUEDA]
UNION ALL
SELECT 'DIAS DE ESTANCIA EGRESOS QUIRURGICOS', '','0', CAST(GETDATE() AS date) AS 'FECHA BUSQUEDA'
UNION ALL 
SELECT 'DIAS DE ESTANCIA EGRESOS NO QUIRURGICOS', [REGIMEN DE SALUD],SUM([DIAS ESTANCIA NO QX]), [FECHA BUSQUEDA] FROM CTE_DIAS_ESTANCIA_NOQX group BY [REGIMEN DE SALUD], [FECHA BUSQUEDA]
UNION ALL
SELECT 'DIAS DE ESTANCIA EGRESOS SALUD MENTAL', [REGIMEN DE SALUD],SUM([DIAS ESTANCIA SM]), [FECHA BUSQUEDA] FROM CTE_DIAS_ESTANCIA_SM group BY [REGIMEN DE SALUD], [FECHA BUSQUEDA]
UNION ALL
SELECT 'DIAS DE ESTANCIA CUIDADOS INTERMEDIOS','', '0', CAST(GETDATE() AS date) AS 'FECHA BUSQUEDA'
UNION ALL
SELECT 'DIAS DE ESTANCIA CUIDADOS INTENSIVOS','', '0', CAST(GETDATE() AS date) AS 'FECHA BUSQUEDA'
UNION ALL 
SELECT 'TOTAL DE DIAS OCUPADOS','', '0', CAST(GETDATE() AS date) AS 'FECHA BUSQUEDA'
UNION ALL 
SELECT 'TOTAL DE DIAS CAMAS DISPONIBLES','', '0', CAST(GETDATE() AS date) AS 'FECHA BUSQUEDA'
UNION ALL
SELECT 'CIRUGIAS GRUPOS 2-6','', '0', CAST(GETDATE() AS date) AS 'FECHA BUSQUEDA'
UNION ALL
SELECT 'CIRUGIAS GRUPOS 7-10', '','0', CAST(GETDATE() AS date) AS 'FECHA BUSQUEDA'
UNION ALL
SELECT 'CIRUGIAS GRUPOS 11-13', '','0', CAST(GETDATE() AS date) AS 'FECHA BUSQUEDA'
UNION ALL
SELECT 'CIRUGIAS GRUPOS 20-23','', '0', CAST(GETDATE() AS date) AS 'FECHA BUSQUEDA'
UNION ALL
SELECT 'EXAMENES DE LABORATORIO', [REGIMEN DE SALUD],SUM(CANTIDAD),[FECHA BUSQUEDA]  FROM CTE_LABORATORIOS group BY [REGIMEN DE SALUD],[FECHA BUSQUEDA]
UNION ALL
SELECT 'IMAGENES DIAGNOSTICAS', [REGIMEN DE SALUD],SUM(CANTIDAD),[FECHA BUSQUEDA] FROM CTE_IMAGENES group BY [REGIMEN DE SALUD],[FECHA BUSQUEDA]
UNION ALL
SELECT 'SESIONES DE TERAPIA RESPIRATORIA REALIZADAS', '','0', CAST(GETDATE() AS date) AS 'FECHA BUSQUEDA'
UNION ALL
SELECT 'SESIONES DE TERAPIA FISICA REALIZADAS', [REGIMEN DE SALUD],SUM(CANTIDAD),[FECHA BUSQUEDA] FROM CTE_FISIOTERAPIA group BY [REGIMEN DE SALUD],[FECHA BUSQUEDA]
UNION ALL 
SELECT 'SESIONES OTRAS TERAPIAS','', '0', CAST(GETDATE() AS date) AS 'FECHA BUSQUEDA'
UNION ALL 
SELECT 'VISITAS DOMICILIARIAS E INSTITUCIONALES - PIC', '','0', CAST(GETDATE() AS date) AS 'FECHA BUSQUEDA'
UNION ALL
SELECT 'SESIONES DE TALLERES COLECTIVOS - PIC', '','0', CAST(GETDATE() AS date) AS 'FECHA BUSQUEDA'
)
select 
CAST(DB_NAME() AS VARCHAR(9)) AS ID_COMPANY, * 
, YEAR([FECHA BUSQUEDA]) AS 'AO FECHA BUSQUEDA'
, MONTH([FECHA BUSQUEDA]) AS 'MES AO FECHA BUSQUEDA'
, CASE MONTH([FECHA BUSQUEDA]) 
	WHEN 1 THEN 'ENERO'
	WHEN 2 THEN 'FEBRERO'
	WHEN 3 THEN 'MARZO'
	WHEN 4 THEN 'ABRIL'
	WHEN 5 THEN 'MAYO'
	WHEN 6 THEN 'JUNIO'
	WHEN 7 THEN 'JULIO'
	WHEN 8 THEN 'AGOSTO'
	WHEN 9 THEN 'SEPTIEMBRE'
	WHEN 10 THEN 'OCTUBRE'
	WHEN 11 THEN 'NOVIEMBRE'
	WHEN 12 THEN 'DICIEMBRE'
  END AS 'MES NOMBRE FECHA BUSQUEDA'
, FORMAT(DAY([FECHA BUSQUEDA]), '00') AS 'DIA FECHA BUSQUEDA',
CONVERT(DATETIME,GETDATE() AT TIME ZONE 'Pakistan Standard Time',1) AS ULT_ACTUAL
from CTE_RES2193
