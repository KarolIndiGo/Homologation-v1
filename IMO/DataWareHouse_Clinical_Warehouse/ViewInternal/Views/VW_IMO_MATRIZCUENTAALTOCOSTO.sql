-- Workspace: IMO
-- Item: DataWareHouse_Clinical [Warehouse]
-- ItemId: 45d58e75-d0a4-4f2b-bd10-65e2dfeda219
-- Schema: ViewInternal
-- Object: VW_IMO_MATRIZCUENTAALTOCOSTO
-- Extracted by Fabric SQL Extractor SPN v3.9.0

CREATE VIEW ViewInternal.IMO_MatrizCuentaAltoCosto
AS

select 
				A.Id, 
				--A.CODDIAGNO, 
				--A.IDEntidadVIE, 
				'' as [Fecha Primera Consulta],
				'' as MesNovedad,
				'' as [Soportes de Dx (Bx, Patologías, etc)],
				'' as Observaciones,
				'' as [Fecha ult. Consulta],
				'' as [Fecha ult.  Revisión],
				'' as [Fecha ult. Actualización SIGIRES],
				A.[1] as PrimerNombreUsuario, 
				A.[2] as SegundoNombreUsuario, 
				A.[3] as PrimerApellidoUsuario, 
				A.[4] as SegundoApellidoUsuario, 
				B.IPNOMCOMP as NombreCompleto,
				'' as [CRUCE INICIOS],
				'' as [CRUCE FINALIZACIONES],
				A.[5] as TipoIdentificacion, 
				A.[6] as NumeroIdentificacion, 
				IIF(A.[7] IS NULL,NULL,FORMAT( A.[7], 'yyyy-MM-dd') )  as FechaNacimiento, 
				A.[8] as Sexo, 
				A.[9] as Ocupacion,
				A.[10] as RegimenAfiliacionSGSSS,  
				s.HealthEntityCode as idEPS ,
				--A.[11], 
				A.[12] as CodigoPertenenciaEtnica, 
				A.[13] as GrupoPoblacional, 
				A.[14] as MunicipioResidencia, 
				A.[15] as NumeroTelefonicopaciente, 
				IIF(A.[16] IS NULL, NULL,FORMAT( A.[16], 'yyyy-MM-dd') ) as FechaAfiliacionEPSRegistra, 
				A.[17] as CIE10, 
				IIF(A.[18] IS NULL, NULL, FORMAT( A.[18], 'yyyy-MM-dd') ) as FechaDx, 
				IIF(A.[19] IS NULL,NULL, FORMAT( A.[19], 'yyyy-MM-dd') ) as FechaNotaRemisionMedico, 
				IIF(A.[20] IS NULL,NULL, FORMAT( A.[20], 'yyyy-MM-dd') ) as FechaIngresoInstitucionRealizo, 
				A.[21] as TipoEstudioRealizoDiagnostico, 
				A.[22] as MotivoUsuarioNOTuvoDiagnostico, 
				IIF(A.[23] IS NULL, NULL, FORMAT( A.[23], 'yyyy-MM-dd') ) as FechaRecoleccionMuestraEstudioHistopatologico, 
				IIF(A.[24] IS NULL, NULL, FORMAT( A.[24], 'yyyy-MM-dd') ) as FechaInformHistopatologicoValido,
				A.[25] as CodigoValidoHabilitacionIPS, 
				IIF(A.[26] IS NULL, NULL, FORMAT( A.[26], 'yyyy-MM-dd') ) as FechaPrimeraConsultaMedicoTratante, 
				A.[27] as HistologiaTumorMuestraBiopsia, 
				A.[28] as GradoDiferenciacionTumorAolidoMaligno, 
				A.[29] as SiEsTumorSolido, 
				IIF(A.[30] IS NULL, NULL, FORMAT( A.[30], 'yyyy-MM-dd') ) as FechaRealizoEstaEstadificacion, 
				A.[31] as ParaCancerMama, 
				IIF(A.[32] IS NULL, NULL, FORMAT( A.[32], 'yyyy-MM-dd') ) as ParaCancerMamaFechaRealizacion, 
				A.[33] as ParaCancerMamaResultadoPrimera, 
				A.[34] as ParaCancerColorrectalEstadificacionDukes, 
				IIF(A.[35] IS NULL, NULL, FORMAT( A.[35], 'yyyy-MM-dd') ) as FechaEstadificacionDukes, 
				A.[36] as EstadificacionLinfomaClinicaHodgkin, 
				A.[37] as CancerProstataValorClasificacionGleason, 
				A.[38] as ClasificacionRiesgoLeucemiasLinfomas, 
				IIF(A.[39] IS NULL, NULL, FORMAT( A.[39], 'yyyy-MM-dd') ) as FechaClasificacionRiesgo, 
				A.[40] as ObjetivoTratamientoMedicoInic, 
				A.[41] as ObjetivoIntervencionMedicaPeriodoReporte, 
				A.[42] as TieneAntecedenteOtroCancerPrimario, 
				IIF(A.[43] IS NULL, NULL, FORMAT( A.[43], 'yyyy-MM-dd') ) as FechaDiagnosticoOtroCancerPrimario, 
				A.[44] as TipoCancerAntecedente, 
				A.[45] as RecibioUsuarioQuimioterapiaPeriodoCorteActual, 
				A.[46] as FaseQuimioterapiaRecibioUsuarioCorte, 
				A.[46.1] as UsuarioRecibioCorteQuimioterapiaPrefase, 
				A.[46.2] as UsuarioRecibioCorteFaseQuimioterapiaInduccion, 
				A.[46.3] as UsuarioRecibioCorteFaseQuimioterapIntensificacion, 
				A.[46.4] as UsuarioRecibioCorteFaseQuimioterapiaConsolidacion, 
				A.[46.5] as UsuarioRecibioCorteFaseQuimioterapiaReinduccion, 
				A.[46.6] as UsuarioRecibiCorteFaseQuimioterapiaMantenimiento, 
				A.[46.7] as UsuarioRecibioCorteFaseQuimioterapiaMantenimientoL, 
				A.[46.8] as UsuarioRecibiCorteOtraFaseQuimioterapia, 
				A.[47] as NumeroCiclosIniciadosPeriodoReporteActual, 
				A.[48] as UbicacionTtemporalPrimerCicloRelacionOncologico, 
				IIF(A.[49] IS NULL, NULL, FORMAT( A.[49], 'yyyy-MM-dd') ) as FechaInicioPrimerCicloQuimioterapiaCorte, 
				A.[50] as NumeroIPSPrimerCicloCorte, 
				A.[51] as CodigoIPS1PrimerCicloCorte, 
				A.[52] as CodigoIPS2PrimerCicloCorte, 
				A.[53] as MedicamentosAntineoplasicosPrimerCicloCorte, 
				A.[53.1] as Medicamentoadm1PrimerEsquema, 
				A.[53.2] as Medicamentoadm2PrimerEsquema, 
				A.[53.3] as Medicamentoadm3PrimerEsquema, 
				A.[53.4] as Medicamentoadm4PrimerEsquema, 
				A.[53.5] as Medicamentoadm5PrimerEsquema, 
				A.[53.6] as Medicamentoadm6PrimerEsquema, 
				A.[53.7] as Medicamentoadm7PrimerEsquema, 
				A.[53.8] as Medicamentoadm8PrimerEsquema, 
				A.[53.9] as Medicamentoadm9PrimerEsquema, 
				A.[54] as MedicamentoNoPOS1AdministradoUsuarioPrimerCiclo, 
				A.[55] as MedicamentoNoPOS2AdministradoUsuarioPrimerCiclo, 
				A.[56] as MedicamentoPOS3AdministradoUsuarioPrimerCiclo, 
				A.[57] as RecibioQuimioterapiaIntratecalPrimerCiclo, 
				IIF(A.[58] IS NULL, NULL, FORMAT( A.[58], 'yyyy-MM-dd') ) as FechaFinalizacionPrimerCicloCorte, 
				A.[59] as CaracteristicasActualesPrimerCicloCorte, 
				A.[60] as MotivoFinalizacionPrimerCiclo, 
				A.[61] as UbicacionTemporalUltimoCicloCorteOncologico, 
				IIF(A.[62] IS NULL, NULL, FORMAT( A.[62], 'yyyy-MM-dd') ) as FechaInicioUltimoCicloQuimioterapiaCorte,
				A.[63] as NumeroIPSSuministranUltimoCicloCorte, 
				A.[64] as CodigoIPS1SuministraUltimoCicloReporte, 
				A.[65] as CodigoIPS2SuministraUltimoCicloReporte, 
				A.[66] as MedicamentosAntineoplasicosEspecialistaCancer, 
				A.[66.1] as Medicamentoadm1UltimoEsquema, 
				A.[66.2] as Medicamentoadm2UltimoEsquema, 
				A.[66.3] as Medicamentoadm3UltimoEsquema, 
				A.[66.4] as Medicamentoadm4UltimoEsquema, 
				A.[66.5] as Medicamentoadm5UltimoEsquema, 
				A.[66.6] as Medicamentoadm6UltimoEsquema, 
				A.[66.7] as Medicamentoadm7UltimoEsquema, 
				A.[66.8] as Medicamentoadm8UltimoEsquema, 
				A.[66.9] as Medicamentoadm9UltimoEsquema, 
				A.[67] as MedicamentoNoPOS1AdministradoUsuarioUltimoCiclo, 
				A.[68] as MedicamentoNoPOS2AdministradoUsuarioUltimoCiclo, 
				A.[69] as MedicamentoNoPOS3AdministradoUsuarioUltimoCiclo, 
				A.[70] as RecibioQuimioterapiaIntratecalUltimoCicloCorte, 
				IIF(A.[71] IS NULL, NULL, FORMAT( A.[71], 'yyyy-MM-dd') ) as FechaFinalizacionCicloUltimo,
				A.[72] as CaracteristicasActualesUltimoCicloCorte, 
				A.[73] as MotivoFinalizacionPrematuraUltimoCiclo, 
				A.[74] as SometidoUsuarioCirugiasCurativasPaliativas, 
				A.[75] as NumeroCirugiasSometidoUsuarioPeriodoReporteActual, 
				IIF(A.[76] IS NULL, NULL, FORMAT( A.[76], 'yyyy-MM-dd') ) as FechaRealizacionPrimeraCirugiaReporte,
				A.[77] as CodigoIPSRealizoPrimeraCirugiaCorte,
				A.[78] as CodigoPrimeraCirugia,
				A.[79] as UbicacionTemporalPrimeraCirugiaOncologico,
				IIF(A.[80] IS NULL, NULL, FORMAT( A.[80], 'yyyy-MM-dd') ) as FechaRealizacionUltimoProcedimientoQuirurgico,
				A.[81] as MotivoHaberRealizadoUltimaIntervencionQuirurgica,
				A.[82] as CodigoIPSRealizaUltimoProcedimientosQuirugicos,
				A.[83] as CodigoUltimaCirugia,
				A.[84] as UbicacionTemporalUltimaCirugiaOncologico,
				A.[85] as EstadoVitalFinalizarUnicaOltimaCirugia,
				A.[86] as RecibioUsuarioAlgunTipoRadioterapiaCorteActual,
				A.[87] as NumeroEsquemasRadioterapiaSuministradosCorteActual,
				IIF(A.[88] IS NULL, NULL, FORMAT( A.[88], 'yyyy-MM-dd') ) as FechaInicioPrimerUnicoEsquemaRadioterapia,
				A.[89] as UbicacionTemporalPrimerUnicoEsquemaRadioterapia,
				A.[90] as TipoRadioterapiaAplicadaPrimerUnicoEsquema,
				A.[91] as NumeroIPSSuministranPrimerUnicoEsquemaRadioterapia,
				A.[92] as CodigoIPS1SuministraRadioterapia,
				A.[93] as CodigoIPS2SuministraRadioterapia,
				IIF(A.[94] IS NULL, NULL, FORMAT( A.[94], 'yyyy-MM-dd') ) as FechaFinalizacionPrimerUnicoEsquemaRadioterapia,
				A.[95] as CaracteristicasActualesPrimerEsquemaRadioterapia, 
				A.[96] as MotivoFinalizacionPrimerEsquemaRadioterapia, 
				IIF(A.[97] IS NULL, NULL, FORMAT( A.[97], 'yyyy-MM-dd') ) as FechaInicioUltimoEsquemaRadioterapia,
				A.[98] as UbicacionTemporalUltimoEsquemaRadioterapia, 
				A.[99] as TipoRadioterapiaAplicadaUltimoEsquemaRadioterapia, 
				A.[100] as NumeroIPSSuministranUltimoEsquemaRadioterapia, 
				A.[101] as CodigoIPS1SuministraRadioterapia1, 
				A.[102] as CodigoIPS2SuministraRadioterapia1, 
				IIF(A.[103] IS NULL, NULL, FORMAT( A.[103], 'yyyy-MM-dd') ) as FechaFinalizacionUltimoEsquemaRadioterapia,
				A.[104] as CaracteristicasActualesUltimoEsquemaRadioterapia, 
				A.[105] as MotivoFinalizacionUltimoEsquemaRadioTerapia, 
				A.[106] as RecibioUsuarioTtrasplanteCelulasProgenitoras, 
				A.[107] as TipoTrasplanteRecibido, 
				A.[108] as UbicacionTemporalTrasplanteOncologico, 
				IIF(A.[109] IS NULL, NULL, FORMAT( A.[109], 'yyyy-MM-dd') ) as FechaTrasplante, 
				A.[110] as CodigoIPSRealizoTrasplante, 
				A.[111] as UsuarioRecibioCirugiaReconstructiva, 
				IIF(A.[112] IS NULL, NULL, FORMAT( A.[112], 'yyyy-MM-dd') ) as FechaCirugia,
				A.[113] as CodigoIPSRealizoCirugiaReconstructiva,
				A.[114] as UsuarioValoradoConsultaProcedimientoPaliativo, 
				A.[114.1] as UsuarioRecibioConsultaProcedimientoCuidadoPaliativo, 
				A.[114.2] as UsuarioRecibioConsultaCuidadoPaliativo, 
				A.[114.3] as UsuarioRecibioConsultaPaliativoEspecialista, 
				A.[114.4] as UsuarioRecibioConsultaPaliativoGeneral, 
				A.[114.5] as UsuarioRecibioConsultaPaliativoTrabajoSocial, 
				A.[114.6] as UsuarioRecibioConsultaPaliativoNoEspecializado, 
				IIF(A.[115] IS NULL, NULL, FORMAT( A.[115], 'yyyy-MM-dd') ) as FechaPrimeraConsultaPaliativoCorte,
				A.[116] as CodigoIPSRecibioPrimeraValoracionPaliativo, 
				A.[117] as HaSidoValoradoUsuarioPorServicioPsiquiatria, 
				IIF(A.[118] IS NULL, NULL, FORMAT( A.[118], 'yyyy-MM-dd') ) as FechaPrimeraConsultaServicioPsiquiatria, 
				A.[119] as CodigoIPSRecibioPrimeraValoracionPsiquiatria,
				A.[120] as FueValoradoUsuarioPorProfesionalNutricion, 
				IIF(A.[121] IS NULL, NULL, FORMAT( A.[121], 'yyyy-MM-dd') ) as FechaConsultaInicialNutricionCorte, 
				A.[122] as CodigoIPSRecibioValoracionNutricion, 
				A.[123] as UusuarioRecibioSoporteNutricional, 
				A.[124] as UsuarioRecibidoTerapiasComplementariasRehabilitacion, 
				A.[125] as TipoTratamientoRecibiendoUsuarioFechaCorte, 
				A.[126] as ResultadoFinalManejoOncologicoCorte, 
				A.[127] as EstadoVitalFinalizarCorte, 
				A.[128] as NovedadADMINISTRATIVAUsuarioReporteAnterior, 
				A.[129] as NovedadClinicaUsuarioFechaCorte, 
				IIF(A.[130] IS NULL, NULL, FORMAT( A.[130], 'yyyy-MM-dd') ) as FechaDesafiliaciIonEPS, 
				IIF(A.[131] IS NULL, NULL, FORMAT( A.[131], 'yyyy-MM-dd') ) as FechaMuerte,
				A.[132] as CausaMuerte, 
				A.[133] as SerialBDUA, 
				IIF(A.[134] IS NULL, NULL, FORMAT( A.[134], 'yyyy-MM-dd') ) as FechaCorte,
				rtrim(B.IPNOMCOMP) as 'Nombre Paciente',
				rtrim(B.IPCODPACI) AS 'Identificacion',
				DATEDIFF(YEAR, B.IPFECNACI, GETDATE()) AS [Edad],
				rtrim(C.CODDIAGNO) + ' - ' + rtrim(C.NOMDIAGNO) AS 'Nombre Diagnostico',
				rtrim(C.CODDIAGNO) as 'Codigo Diagnostico',
				rtrim(s.Name) as 'Nombre Entidad'
			from
				[INDIGO035].[dbo].[HCONCOPREG] A
				Inner Join [INDIGO035].[dbo].[INPACIENT] B on A.[6] = B.IPCODPACI 
				Inner Join [INDIGO035].[dbo].[INDIAGNOS] C on C.CODDIAGNO = A.CODDIAGNO  
				Inner Join [INDIGO035].[Contract].[HealthAdministrator] s ON s.Id = A.IDEntidadVIE 
			--WHERE b.IPCODPACI='36285080'
			--WHERE s.HealthEntityCode='ESS062'
			--AND S.Name='ASMET SALUD EPS S.A.S SUBSIDIADO'
			WHERE A.[10] <>'N' --RegimenAfiliacionSGSSS,
			AND A.[13] IN ('5','31','61') --GrupoPoblacional
			AND A.[21] IN ('5','6','7','10','99') --TipoEstudioRealizoDiagnostico
			AND A.[22] IN ('6','98','99') --MotivoUsuarioNOTuvoDiagnostico
			--AND A.[6] ='26427755'
